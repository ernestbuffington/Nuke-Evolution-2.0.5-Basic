/***************************************************************************/
/* ForumNews Advance v3.0                                          INSTALL */
/* Simplified for Nuke-Evolution by Technocrat & Rodmar                    */
/*                                                                         */
/* Install instructions                                                    */
/* Steps to complete: 22                                                   */
/*                                                                         */
/* 1. Upload all included files from html/ to the root of your site!       */
/*                                                                         */
/* 2. Go to www.yoursite.com/modules.php?name=ForumNews&file=install       */
/*    Overview: Select First Time Install of ForumNews Advance             */
/*              and click Adjust DB.                                       */
/*    Info: This will install relevant tables into your site database.     */
/*                                                                         */
/***************************************************************************/
#
#-----[ NOTE ]-----------------------------------------
#
For every file you open you will see something like:
/*****[CHANGES]**********************************************************
-=[Base]=-
      Nuke Patched                             v3.1.0       06/26/2005
-=[Mod]=-
      Lock Modules                             v1.0.0       08/04/2005
 ************************************************************************/

I would suggest adding an entry for the FNA in every file but that
is completely up to you.  Here is what that would look like:
/*****[CHANGES]**********************************************************
-=[Base]=-
      Nuke Patched                             v3.1.0       06/26/2005
-=[Mod]=-
      Lock Modules                             v1.0.0       08/04/2005
      FNA                                      v3.0.0       09/16/2005
 ************************************************************************/
 
#
#-----[ OPEN ]-----------------------------------------
#
includes/auth.php

#
#-----[ FIND ]-----------------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     Global Announcements               v1.2.8 ]
 ******************************************************/
                        $a_sql = 'a.auth_view, a.auth_read, a.auth_post, a.auth_reply, a.auth_edit, a.auth_delete, a.auth_sticky, a.auth_announce, a.auth_vote, a.auth_pollcreate, a.auth_globalannounce';
                        $auth_fields = array('auth_view', 'auth_read', 'auth_post', 'auth_reply', 'auth_edit', 'auth_delete', 'auth_sticky', 'auth_announce', 'auth_vote', 'auth_pollcreate', 'auth_globalannounce');
/*****[END]********************************************
 [ Mod:     Global Announcements               v1.2.8 ]
 ******************************************************/
 
#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     Global Announcements               v1.2.8 ]
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                        $a_sql = 'a.auth_view, a.auth_read, a.auth_news, a.auth_post, a.auth_reply, a.auth_edit, a.auth_delete, a.auth_sticky, a.auth_announce, a.auth_vote, a.auth_pollcreate, a.auth_globalannounce';
                        $auth_fields = array('auth_view', 'auth_read', 'auth_news', 'auth_post', 'auth_reply', 'auth_edit', 'auth_delete', 'auth_sticky', 'auth_announce', 'auth_vote', 'auth_pollcreate', 'auth_globalannounce');
/*****[END]********************************************
 [ Mod:     Global Announcements               v1.2.8 ]
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
includes/constants.php

#
#-----[ FIND ]-----------------------------------------
#
/*--FNA--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
define('NEWS_TABLE', $prefix.'_bbnews');
define('APPROVE_POSTS_TABLE', $prefix.'_bbapprove_posts');
define('APPROVE_FORUMS_TABLE', $prefix.'_bbapprove_forums');
define('APPROVE_TOPICS_TABLE', $prefix.'_bbapprove_topics');
define('APPROVE_USERS_TABLE', $prefix.'_bbapprove_users');
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
includes/functions.php

#
#-----[ FIND ]-----------------------------------------
#
    /*--FNA #1--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
    include($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . '/lang_news.' . $phpEx);
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
 
#
#-----[ FIND ]-----------------------------------------
#
                /*--FNA #2--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                include($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . '/lang_news.' . $phpEx);
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
                /*--FNA #3--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                include($phpbb_root_path . 'language/lang_english/lang_news.' . $phpEx);
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
includes/functions_post.php

#
#-----[ FIND ]-----------------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:    Must first vote to see results      v1.0.0 ]
 ******************************************************/
function submit_post($mode, &$post_data, &$message, &$meta, &$forum_id, &$topic_id, &$post_id, &$poll_id, &$topic_type, &$bbcode_on, &$html_on, &$smilies_on, &$attach_sig, &$bbcode_uid, $post_username, $post_subject, $post_message, $poll_title, &$poll_options, &$poll_length, &$poll_view_toggle)
/*****[END]********************************************
 [ Mod:    Must first vote to see results      v1.0.0 ]
 ******************************************************/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     Must first vote to see results     v1.0.0 ]
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
function submit_post($mode, &$post_data, &$message, &$meta, &$forum_id, &$topic_id, &$post_id, &$poll_id, &$topic_type, &$bbcode_on, &$html_on, &$smilies_on, &$attach_sig, &$bbcode_uid, $post_username, $post_subject, $post_message, $poll_title, &$poll_options, &$poll_length, &$poll_view_toggle, &$news_category)
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 [ Mod:     Must first vote to see results     v1.0.0 ]
 ******************************************************/
 
#
#-----[ FIND ]-----------------------------------------
#
            /*--FNA--*/


#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
        if( isset( $news_category ) && is_numeric( $news_category ) )
        {
            $news_id = intval( $news_category );
        }
        else
        {
            $news_id = 0;
        }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
                $sql  = ($mode != "editpost") ? "INSERT INTO " . TOPICS_TABLE . " (topic_title, topic_poster, topic_time, forum_id, topic_status, topic_type, topic_vote) VALUES ('$post_subject', " . $userdata['user_id'] . ", '$current_time', '$forum_id', " . TOPIC_UNLOCKED . ", '$topic_type', '$topic_vote')" : "UPDATE " . TOPICS_TABLE . " SET topic_title = '$post_subject', topic_type = $topic_type " . (($post_data['edit_vote'] || !empty($poll_title)) ? ", topic_vote = " . $topic_vote : "") . " WHERE topic_id = '$topic_id'";

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                $sql  = ($mode != "editpost") ? "INSERT INTO " . TOPICS_TABLE . " (topic_title, topic_poster, topic_time, forum_id, news_id, topic_status, topic_type, topic_vote) VALUES ('$post_subject', " . $userdata['user_id'] . ", $current_time, $forum_id, $news_id, " . TOPIC_UNLOCKED . ", $topic_type, $topic_vote)" : "UPDATE " . TOPICS_TABLE . " SET topic_title = '$post_subject', news_id = '$news_id', topic_type = $topic_type " . (($post_data['edit_vote'] || !empty($poll_title)) ? ", topic_vote = " . $topic_vote : "") . " WHERE topic_id = $topic_id";
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
includes/topic_review.php

#
#-----[ FIND ]-----------------------------------------
#
        /*--FNA #1--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
        $approve_mod = array();
        $approve_sql = "SELECT * FROM " . APPROVE_FORUMS_TABLE . " 
                WHERE forum_id = " . intval($forum_id);
        if ( !($approve_result = $db->sql_query($approve_sql)) )
        {
                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
        }
        if ( $approve_mod = $db->sql_fetchrow($approve_result) )
        {
                if ( intval($approve_mod['enabled']) == 1)
                {
                        $approve_mod['enabled'] = true;
                }
        }
        $approve_mod['moderators'] = array();
        $approve_mod['moderators'] = explode('|', $approve_mod['approve_moderators']);
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
                        /*--FNA #2--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                        if ( $approve_mod['enabled'] )
                        {
                                $approve_mod['posts_awaiting'] = false;
                                $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                                        WHERE post_id = " . intval($row['post_id']) . " 
                                        LIMIT 0,1";
                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                {
                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                }
                                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                {
                                        if ( intval($approve_row['post_id']) == intval($row['post_id']) )
                                        {
                                                $approve_mod['posts_awaiting'] = true;
                                        }
                                }
                                if ( $approve_mod['posts_awaiting'] )
                                {
                                        if ( in_array($userdata['user_id'], $approve_mod['moderators']) || $is_auth['auth_mod'] )
                                        {
                                                $post_subject = $post_subject . "<br />[ " . $lang['approve_post_is_awaiting'] . " ]";
                                        }
                                        else
                                        {
                                                if ( $approve_mod['forum_hide_unapproved_posts'] )
                                                {
                                                        continue;
                                                }
                                                else
                                                {
                                                        $post_subject = "[ " . $lang['approve_post_is_awaiting'] . " ]";
                                                        $message = $post_subject;
                                                }
                                        }
                                }
                        }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
modules/Forums/index.php

#
#-----[ FIND ]-----------------------------------------
#
                                                        /*--FNA--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                                                        $approve_mod = array();
                                                        $approve_sql = "SELECT enabled, approve_moderators, forum_hide_unapproved_posts, forum_hide_unapproved_topics 
                                                                FROM " . APPROVE_FORUMS_TABLE . " 
                                                                WHERE forum_id = " . intval($forum_data[$j]['forum_id']) . " LIMIT 0,1";
                                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                        {
                                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                                        }
                                                        if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                                        {
                                                                if ( intval($approve_row['enabled']) == 1 )
                                                                {
                                                                        $approve_mod = $approve_row;
                                                                        $approve_mod['enabled'] = true;
                                                                }
                                                        }
                                                        if ( $approve_mod['enabled'] )
                                                        {

                                                                if ( $forum_data[$j]['user_id'] == ANONYMOUS || $approve_mod['forum_hide_unapproved_posts'] || $approve_mod['forum_hide_unapproved_topics'] )
                                                                {
                                                                        $approve_mod['moderators'] = array();
                                                                        $approve_mod['moderators'] = explode('|', $approve_mod['approve_moderators']);

                                                                        if ( !in_array($userdata['user_id'], $approve_mod['moderators']) && !$is_auth_ary[$forum_id]['auth_mod'] && $last_post != $lang['No_Posts'] )
                                                                        {
                                                                                $approve_sql = "SELECT * 
                                                                                        FROM " . APPROVE_POSTS_TABLE . " 
                                                                                        WHERE post_id = " . intval($forum_data[$j]['forum_last_post_id']) . " 
                                                                                        LIMIT 0,1";
                                                                                if ( !$approve_result = $db->sql_query($approve_sql) )
                                                                                {
                                                                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                                                                }
                                                                                $approve_row = $db->sql_fetchrow($approve_result);
                                                                                if ( intval($approve_row['post_id']) == intval($forum_data[$j]['forum_last_post_id']) )
                                                                                {
                                                                                        if ( $approve_mod['forum_hide_unapproved_posts'] || $approve_mod['forum_hide_unapproved_topics'] )
                                                                                        {
                                                                                                $approve_sql = "SELECT p.post_id, p.poster_id, p.post_time, p.post_username, u.username, u.user_id 
                                                                                                        FROM " . POSTS_TABLE . " p, " . USERS_TABLE . " u 
                                                                                                        WHERE p.forum_id = " . intval($forum_data[$j]['forum_id']) . "
                                                                                                        AND u.user_id = p.poster_id 
                                                                                                        ORDER BY p.post_time DESC";
                                                                                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                                                                {
                                                                                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                                                                                }
                                                                                                while( $approve_row = $db->sql_fetchrow($approve_result) )
                                                                                                {
                                                                                                        $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                                                                                                                WHERE post_id = " . intval($approve_row['post_id']) . " 
                                                                                                                LIMIT 0,1";
                                                                                                        if ( !($approve_result2 = $db->sql_query($approve_sql)) )
                                                                                                        {
                                                                                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                                                                                        }
                                                                                                        $approve_row2 = $db->sql_fetchrow($approve_result2);
                                                                                                        if ( !$approve_row2['post_id'] )
                                                                                                        {
                                                                                                                $last_post_time = create_date($board_config['default_dateformat'], $approve_row['post_time'], $board_config['board_timezone']);
                                                                                                                $last_post = $last_post_time . '<br />';

                                                                                                                $last_post .= ( $approve_row['user_id'] == ANONYMOUS ) ? ( ($approve_row['post_username'] != '' ) ? $approve_row['post_username'] . ' ' : $lang['Guest'] . ' ' ) : '<a href="' . append_sid("profile.$phpEx?mode=viewprofile&amp;" . POST_USERS_URL . '='  . $approve_row['poster_id']) . '">' . $approve_row['username'] . '</a> ';

                                                                                                                $last_post .= '<a href="' . append_sid("viewtopic.$phpEx?"  . POST_POST_URL . '=' . $approve_row['post_id']) . '#' . $approve_row['post_id'] . '"><img src="' . $images['icon_latest_reply'] . '" border="0" alt="' . $lang['View_latest_post'] . '" title="' . $lang['View_latest_post'] . '" /></a>';
                                                                                                                break;
                                                                                                        }
                                                                                                }
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                                $last_post = $last_post_time . '<br />';
                                                                                                $last_post .= $lang['Guest'] . '  ' . '<a href="' . append_sid("viewforum.$phpEx?"  . POST_FORUM_URL . '=' . $forum_data[$j]['forum_id']) . '"><img src="' . $images['icon_latest_reply'] . '" border="0" alt="' . $lang['View_latest_post'] . '" title="' . $lang['View_latest_post'] . '" /></a>';
                                                                                        }
                                                                                }
                                                                        }
                                                                }
                                                        }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
modules/Forums/posting.php

#
#-----[ FIND ]-----------------------------------------
#
$forum_id	= request_var('f', 0);

#
#-----[ AFTER, ADD ]-----------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
$news_category	= request_var('news_category', 0);
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
$refresh = $preview || $poll_add || $poll_edit || $poll_delete;

#
#-----[ REPLACE WITH ]-----------------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
$refresh = $news_category || $preview || $poll_add || $poll_edit || $poll_delete;
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
$mode        = ($delete && !$preview && !$refresh && $submit) ? 'delete' : request_var('mode', '');
#
#-----[ REPLACE WITH ]-----------------------------------------
#
 /*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
$mode		= ($delete && !$news_category && !$preview && !$refresh  && $submit) ? 'delete' : request_var('mode', '');
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
#
#-----[ FIND ]-----------------------------------------
#
                $select_sql = (!$submit) ? ', t.topic_title, p.enable_bbcode, p.enable_html, p.enable_smilies, p.enable_sig, p.post_username, pt.post_subject, pt.post_text, pt.bbcode_uid, u.username, u.user_id, u.user_sig, u.user_sig_bbcode_uid' : '';

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                $select_sql = (!$submit) ? ', t.topic_title, t.news_id, p.enable_bbcode, p.enable_html, p.enable_smilies, p.enable_sig, p.post_username, pt.post_subject, pt.post_text, pt.bbcode_uid, u.username, u.user_id, u.user_sig, u.user_sig_bbcode_uid' : '';
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
        /*--FNA #1--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
        if( $board_config['allow_news'] && $post_data['first_post'] && $is_auth['auth_post'] && ($is_auth['auth_news'] || ( $is_auth['auth_mod'] && $mode == 'editpost') ) )
        {
                if( $mode == 'editpost' )
                {
                        $post_data['news_id'] = $post_info['news_id'];
                }
                else
                {
                        $post_data['news_id'] = 0;
                }
                $post_data['disp_news'] = true;
        }
        else
        {
                $post_data['disp_news'] = false;
        }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
/*--FNA #2--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
if ( $mode == 'newtopic' || $mode == 'reply' || $mode == 'editpost' || $mode == 'quote' )
{
        $approve_mod = array();
        $approve_mod['notify'] = false;
        $approve_sql = "SELECT * 
                FROM " . APPROVE_FORUMS_TABLE . " 
                WHERE forum_id = " . intval($forum_id);
        if ( !($approve_result = $db->sql_query($approve_sql)) )
        {
                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
        }
        if ( $approve_row = $db->sql_fetchrow($approve_result) )
        {
                if ( intval($approve_row['enabled']) == 1 )
                {
                        $approve_mod = $approve_row;
                        $approve_mod['enabled'] = true;
                }
        }
        $approve_mod['moderators'] = array();
        $approve_mod['moderators'] = explode('|', $approve_mod['approve_moderators']);
        if ( in_array($userdata['user_id'], $approve_mod['moderators']) || $is_auth['auth_mod'] )
        {
                //moderator, don't screen their post
                $approve_mod['enabled'] = false;
        }

        if ( $approve_mod['enabled'] )
        {
                if ( $approve_mod['forum_hide_unapproved_posts'] )
                {
                        $lang['Stored'] = $lang['approve_admin_Stored_replacement'];
                }
                //
                // Check if quoted post is approved
                //
                if ( $mode == 'quote' )
                {
                        // patch purpose proposed by Markus Rietzler < markus.rietzler@rzf.fin-nrw.de >
                        // check if the quoted post has been approved, if so, empty the quote text
                        $approve_sql = "SELECT * 
                                        FROM " . APPROVE_POSTS_TABLE . " 
                                        WHERE post_id = " . intval($post_id) . " 
                                                AND is_post = 1";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                        }
                        if ( $approve_row = $db->sql_fetchrow($approve_result) )
                        {
                                //quoted post is not approved
                                $approve_mod['quoted_post_not_approved'] = true;
                        }
                }

                //
                // Check user and topic moderation
                //
                if ( $approve_mod['approve_users'] )
                {
                        //all users & topics, let's check them to see if we should disable moderation
                        if ( $approve_mod['approve_posts'] && $mode != 'newtopic' )
                        {
                                $approve_sql = "SELECT approve_moderate 
                                        FROM " . APPROVE_TOPICS_TABLE . " 
                                        WHERE topic_id = " . intval($topic_id) . " 
                                                AND approve_moderate = -1 
                                        LIMIT 0,1";
                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                {
                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                }
                                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                {
                                        if ( intval($approve_row['approve_moderate']) == -1 )
                                        {
                                                //topic auto-approved
                                                $approve_mod['enabled'] = false;
                                        }
                                }
                        }
                        if ( $approve_mod['enabled'] )
                        {
                                $approve_sql = "SELECT approve_moderate 
                                        FROM " . APPROVE_USERS_TABLE . " 
                                        WHERE user_id = " . intval($userdata['user_id']) . " 
                                                AND approve_moderate = -1 
                                        LIMIT 0,1";
                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                {
                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                }
                                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                {
                                        if ( intval($approve_row['approve_moderate']) == -1 )
                                        {
                                                //user auto-approved
                                                $approve_mod['enabled'] = false;
                                        }
                                }
                        }
                }
                else
                {
                        //only selected topics, let's check them to see if we should turn on moderation
                        $approve_mod['enabled'] = false;
                        $approve_sql = "SELECT * 
                                FROM " . APPROVE_TOPICS_TABLE . " 
                                WHERE topic_id = " . intval($topic_id) . " 
                                LIMIT 0,1";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                        }
                        if ( $approve_row = $db->sql_fetchrow($approve_result) )
                        {
                                if ( intval($approve_row['approve_moderate']) == 1 )
                                {
                                        //topic is moderated
                                        $approve_mod['enabled'] = true;
                                }
                        }
                }
                //check the user to see if we should still moderate them, regardless of topic settings
                if ( !$approve_mod['enabled'] )
                {
                        $approve_sql = "SELECT * 
                                FROM " . APPROVE_USERS_TABLE . " 
                                WHERE user_id = " . intval($userdata['user_id']) . " 
                                LIMIT 0,1";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                        }
                        if ( $approve_row = $db->sql_fetchrow($approve_result) )
                        {
                                if ( intval($approve_row['approve_moderate']) == 1 )
                                {
                                        //user is moderated
                                        $approve_mod['enabled'] = true;
                                }
                        }
                }
                if ( $approve_mod['enabled'] )
                {
                        //check admin settings for what to allow & what to moderate
                        switch ($mode)
                        {
                                case 'newtopic':
                                        if ( intval($approve_mod['approve_topics']) != 1 )
                                        {
                                                //new topics are not moderated
                                                $approve_mod['enabled'] = false;
                                        }
                                break;

                                case 'reply':
                                case 'quote':
                                        if ( intval($approve_mod['approve_posts']) != 1 )
                                        {
                                                //new replies are not moderated
                                                $approve_mod['enabled'] = false;
                                        }
                                break;

                                case 'editpost':
                                        if ( intval($approve_mod['approve_poste']) != 1 )
                                        {
                                                //post edits are not moderated
                                                $approve_mod['enabled'] = false;
                                        }
                                        $approve_mod_post_id = ($HTTP_GET_VARS[POST_POST_URL]) ? $HTTP_GET_VARS[POST_POST_URL] : $HTTP_POST_VARS[POST_POST_URL];
                                        if ( !$approve_mod['enabled'] && ( intval($approve_mod['approve_topice']) == 1 ) && !empty($approve_mod_post_id) )
                                        {
                                                //let's see if it's a topic and if so, turn moderation back on
                                                $approve_sql = "SELECT t.topic_first_post_id 
                                                        FROM " . TOPICS_TABLE . " t, " . POSTS_TABLE . " p 
                                                        WHERE p.post_id = " . intval($approve_mod_post_id) . " 
                                                                AND t.topic_id = p.topic_id 
                                                        LIMIT 0,1";
                                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                {
                                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                                }
                                                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                                {
                                                        if ( intval($approve_row['topic_first_post_id']) == intval($approve_mod_post_id) )
                                                        {
                                                                //topic edits are moderated
                                                                $approve_mod['enabled'] = true;
                                                        }
                                                }
                                        }
                                break;
                        }
                }
        }
}

if( $userdata['session_logged_in'] && $post_data['disp_news'] )
{
        if ( $mode == 'edit' && empty($post_id) )
        {
                message_die(GENERAL_MESSAGE, $lang['No_post_id']);
        }

         $sql = 'SELECT n.* FROM ' . NEWS_TABLE . ' n WHERE 1 ORDER BY n.news_category';

        if ( !($result = $db->sql_query($sql)) )
        {
                message_die(GENERAL_ERROR, 'Could not obtain news data', '', __LINE__, __FILE__, $sql);
        }

        $news_sel = array();
        $news_cat = array();
        while ( $row = $db->sql_fetchrow($result) )
        {
                if( ($news_category > 0 && $news_category == $row['news_id']) || ($post_data['news_id'] > 0 && $post_data['news_id'] == $row['news_id']) )
                {
                                $news_sel = $row;
                }
                
                if( $post_data['news_id'] != 0 && $post_data['news_id'] == $row['news_id'] )
                {
                        $news_sel = $row;
                }
                $news_cat[] = $row;
        }

        if( $post_data['news_id'] == 0 && $news_category == 0)
        {
                $boxstring = '<option value="0">' . $lang['Regular_Post'] . '</option>';
        }
        else
        {
                $boxstring = '<option value="' . $news_sel['news_id'] .'">' . $news_sel['news_category'] . ' (' . $lang['Current_Selection'] . ')</option>';
                $boxstring .= '<option value="0">' . $lang['Regular_Post'] . '</option>';
        }

        if( count( $news_cat ) > 0 )
        {
                for( $i = 0; $i < count( $news_cat ); $i++ )
                {
                        if( $news_cat[$i]['news_id'] != $post_data['news_id'] )
                        {
                                $boxstring .= '<option value="' . $news_cat[$i]['news_id'] . '">' . $news_cat[$i]['news_category'] . '</option>';
                        }
                }

                $template->assign_block_vars('switch_news_cat', array(
                        'L_NEWS_CATEGORY' => $lang['Select_News_Category'],
                        'S_NAME' => 'news_category',
                        'S_CATEGORY_BOX' => $boxstring
                ));
        }
}
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
#
                                /*--FNA REPLACE 1--*/
                                submit_post($mode, $post_data, $return_message, $return_meta, $forum_id, $topic_id, $post_id, $poll_id, $topic_type, $bbcode_on, $html_on, $smilies_on, $attach_sig, $bbcode_uid, str_replace("\'", "''", $username), str_replace("\'", "''", $subject), str_replace("\'", "''", $message), str_replace("\'", "''", $poll_title), $poll_options, $poll_length, $poll_view_toggle);

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                                submit_post($mode, $post_data, $return_message, $return_meta, $forum_id, $topic_id, $post_id, $poll_id, $topic_type, $bbcode_on, $html_on, $smilies_on, $attach_sig, $bbcode_uid, str_replace("\'", "''", $username), str_replace("\'", "''", $subject), str_replace("\'", "''", $message), str_replace("\'", "''", $poll_title), $poll_options, $poll_length, $poll_view_toggle, $news_category);
                                if ( $approve_mod['enabled'] )
                                {
                                        if ( $mode == 'newtopic' && $approve_mod['approve_topics'] )
                                        {
                                                $approve_sql = "INSERT INTO " . APPROVE_POSTS_TABLE . " (post_id, topic_id, is_topic, is_post, poster_id) 
                                                        VALUES (" . intval($post_id) . ", " . intval($topic_id) . ", 1, 1, " . intval($userdata['user_id']) . ")";
                                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                {
                                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_insert'], '', __LINE__, __FILE__, $approve_sql);
                                                }
                                                if ( $approve_mod['approve_notify_topics'] )
                                                {
                                                        $approve_mod['notify'] = true;
                                                }
                                        }
                                        elseif ( $mode == 'reply' && $approve_mod['approve_posts'] )
                                        {
                                                $approve_sql = "INSERT INTO " . APPROVE_POSTS_TABLE . " (post_id, topic_id, is_post, poster_id) 
                                                        VALUES (" . intval($post_id) . ", " . intval($topic_id) . ", 1, " . intval($userdata['user_id']) . ")";
                                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                {
                                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_insert'], '', __LINE__, __FILE__, $approve_sql);
                                                }
                                                if ( $approve_mod['approve_notify_posts'] && $approve_mod['approve_notify'] )
                                                {
                                                        $approve_mod['notify'] = true;
                                                }
                                        }
                                        elseif ( $mode == 'editpost' )
                                        {
                                                $approve_mod['topic_or_post'] = 'is_post';
                                                $approve_sql = "SELECT t.topic_first_post_id FROM " . TOPICS_TABLE . " t, " . POSTS_TABLE . " p 
                                                        WHERE p.post_id = " . intval($post_id) . " 
                                                                AND t.topic_id = p.topic_id 
                                                        LIMIT 0,1";
                                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                {
                                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                                }
                                                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                                {
                                                        if ( intval($approve_row['topic_first_post_id']) == intval($post_id) )
                                                        {
                                                                $approve_mod['topic_or_post'] = 'is_topic';
                                                        }
                                                }
                                                if ( (($approve_mod['topic_or_post'] == 'is_topic') && $approve_mod['approve_topice']) || (($approve_mod['topic_or_post'] == 'is_post') && $approve_mod['approve_poste']) )
                                                {
                                                        $approve_sql = "DELETE FROM " . APPROVE_POSTS_TABLE . " 
                                                                WHERE topic_id = " . intval($topic_id) . " 
                                                                        AND post_id = " . intval($post_id);
                                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                        {
                                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $approve_sql);
                                                        }
                                                        $approve_sql = "INSERT INTO " . APPROVE_POSTS_TABLE . " (post_id, topic_id, " . $approve_mod['topic_or_post'] . ", poster_id) 
                                                                VALUES (" . intval($post_id) . ", " .  intval($topic_id) . ", 1, " . intval($userdata['user_id']) . ")";
                                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                        {
                                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_insert'], '', __LINE__, __FILE__, $approve_sql);
                                                        }
                                                        if ( $approve_mod['approve_notify_topice'] && ($approve_mod['topic_or_post'] == 'is_topic'))
                                                        {
                                                                $approve_mod['notify'] = true;
                                                        }
                                                        if ( $approve_mod['approve_notify_poste'] && ($approve_mod['topic_or_post'] == 'is_post'))
                                                        {
                                                                $approve_mod['notify'] = true;
                                                        }
                                                }
                                        }
                                }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
#
                                /*--FNA REPLACE 2--*/
                                submit_post($mode, $post_data, $return_message, $return_meta, $forum_id, $topic_id, $post_id, $poll_id, $topic_type, $bbcode_on, $html_on, $smilies_on, $attach_sig, $bbcode_uid, str_replace("\'", "''", $username), str_replace("\'", "''", $subject), str_replace("\'", "''", $message), str_replace("\'", "''", $poll_title), $poll_options, $poll_length, $poll_view_toggle);

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                                submit_post($mode, $post_data, $return_message, $return_meta, $forum_id, $topic_id, $post_id, $poll_id, $topic_type, $bbcode_on, $html_on, $smilies_on, $attach_sig, $bbcode_uid, str_replace("\'", "''", $username), str_replace("\'", "''", $subject), str_replace("\'", "''", $message), str_replace("\'", "''", $poll_title), $poll_options, $poll_length, $poll_view_toggle, $news_category);
                                if ( $approve_mod['enabled'] )
                                {
                                        if ( $mode == 'newtopic' && $approve_mod['approve_topics'] )
                                        {
                                                $approve_sql = "INSERT INTO " . APPROVE_POSTS_TABLE . " (post_id, topic_id, is_topic, is_post, poster_id) 
                                                        VALUES (" . intval($post_id) . ", " . intval($topic_id) . ", 1, 1, " . intval($userdata['user_id']) . ")";
                                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                {
                                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_insert'], '', __LINE__, __FILE__, $approve_sql);
                                                }
                                                if ( $approve_mod['approve_notify_topics'] )
                                                {
                                                        $approve_mod['notify'] = true;
                                                }
                                        }
                                        elseif ( $mode == 'reply' && $approve_mod['approve_posts'] )
                                        {
                                                $approve_sql = "INSERT INTO " . APPROVE_POSTS_TABLE . " (post_id, topic_id, is_post, poster_id) 
                                                        VALUES (" . intval($post_id) . ", " . intval($topic_id) . ", 1, " . intval($userdata['user_id']) . ")";
                                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                {
                                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_insert'], '', __LINE__, __FILE__, $approve_sql);
                                                }
                                                if ( $approve_mod['approve_notify_posts'] && $approve_mod['approve_notify'] )
                                                {
                                                        $approve_mod['notify'] = true;
                                                }
                                        }
                                        elseif ( $mode == 'editpost' )
                                        {
                                                $approve_mod['topic_or_post'] = 'is_post';
                                                $approve_sql = "SELECT t.topic_first_post_id FROM " . TOPICS_TABLE . " t, " . POSTS_TABLE . " p 
                                                        WHERE p.post_id = " . intval($post_id) . " 
                                                                AND t.topic_id = p.topic_id 
                                                        LIMIT 0,1";
                                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                {
                                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                                }
                                                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                                {
                                                        if ( intval($approve_row['topic_first_post_id']) == intval($post_id) )
                                                        {
                                                                $approve_mod['topic_or_post'] = 'is_topic';
                                                        }
                                                }
                                                if ( (($approve_mod['topic_or_post'] == 'is_topic') && $approve_mod['approve_topice']) || (($approve_mod['topic_or_post'] == 'is_post') && $approve_mod['approve_poste']) )
                                                {
                                                        $approve_sql = "DELETE FROM " . APPROVE_POSTS_TABLE . " 
                                                                WHERE topic_id = " . intval($topic_id) . " 
                                                                        AND post_id = " . intval($post_id);
                                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                        {
                                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $approve_sql);
                                                        }
                                                        $approve_sql = "INSERT INTO " . APPROVE_POSTS_TABLE . " (post_id, topic_id, " . $approve_mod['topic_or_post'] . ", poster_id) 
                                                                VALUES (" . intval($post_id) . ", " .  intval($topic_id) . ", 1, " . intval($userdata['user_id']) . ")";
                                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                        {
                                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_insert'], '', __LINE__, __FILE__, $approve_sql);
                                                        }
                                                        if ( $approve_mod['approve_notify_topice'] && ($approve_mod['topic_or_post'] == 'is_topic'))
                                                        {
                                                                $approve_mod['notify'] = true;
                                                        }
                                                        if ( $approve_mod['approve_notify_poste'] && ($approve_mod['topic_or_post'] == 'is_post'))
                                                        {
                                                                $approve_mod['notify'] = true;
                                                        }
                                                }
                                        }
                                }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
                        /*--FNA #3--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                        $sql = "DELETE FROM " . APPROVE_POSTS_TABLE . " 
                                WHERE post_id = " . intval($post_id);
                        if ( !($result = $db->sql_query($sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $sql);
                        }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
                /*--FNA #4--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                if ( $approve_mod['notify'] && $approve_mod['approve_notify'] )
                {
                        $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                                WHERE post_id = " . intval($post_id) . " 
                                LIMIT 0,1";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                        }
                        if ( $approve_row = $db->sql_fetchrow($approve_result) )
                        {
                                for($i = 0; !empty($approve_mod['moderators'][$i]); $i++)
                                {
                                        $approve_sql = "SELECT user_email, user_notify_pm, user_active FROM " . USERS_TABLE . " 
                                                WHERE user_id = " . intval($approve_mod['moderators'][$i]) . " 
                                                LIMIT 0,1";
                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                        {
                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                        }
                                        if ( $to_userdata = $db->sql_fetchrow($approve_result) )
                                        {
                                                if ( intval($approve_mod['approve_notify_type']) == -1)
                                                {
                                                        $email_headers = 'From: ' . $board_config['board_email'] . "\nReturn-Path: " . $board_config['board_email'] . "\n";
                                                        $script_name = preg_replace('/^\/?(.*?)\/?$/', "\\1", trim($board_config['script_path']));
                                                        $script_name = '/modules.php?name=Forums&file=viewtopic';
                                                        $server_name = trim($board_config['server_name']);
                                                        $server_protocol = ( $board_config['cookie_secure'] ) ? 'https://' : 'http://';
                                                        $server_port = ( $board_config['server_port'] <> 80 ) ? ':' . trim($board_config['server_port']) . '/' : '/';
                                                        if ( !class_exists('emailer') )
                                                        {
                                                                @include_once('includes/emailer.'.$phpEx);
                                                        }
                                                        $emailer = new emailer($board_config['smtp_delivery']);
                                                        $emailer->extra_headers($email_headers);
                                                        $emailer->email_address($to_userdata['user_email']);
                                                        $emailer->set_subject($board_config['sitename'] . " : " . $lang['approve_notify_subject'] . " " . $post_id);
                                                        $emailer->msg = $board_config['sitename'] . "\n" . $lang['approve_notify_link'] . "\n" . $server_protocol . $server_name . $server_port . $script_name . '&'. POST_POST_URL . '=' . $post_id . '#' . $post_id;
                                                        $emailer->msg .= "\n\n" . $lang['approve_notify_approve_link'] . "\n" . $server_protocol . $server_name . $server_port . $script_name . '&'. POST_POST_URL . '=' . $post_id . '&app_p=' . $post_id . '#' . $post_id;
                                                        if ( intval($approve_mod['approve_notify_message']) == 1 )
                                                        {
                                                                $emailer->msg .= (!empty($board_config['board_email_sig'])) ? str_replace('<br />', "\n", "\n\n" . $board_config['board_email_sig']) : '';
                                                                $emailer->msg .= "\n\n". $lang['approve_notify_message'] ."\n----------------------------\n";
                                                                $emailer->msg .= ( intval($approve_mod['approve_notify_message_len']) != 0 && (strlen($message) > intval($approve_mod['approve_notify_message_len']) ) ) ? substr($message, 0, intval($approve_mod['approve_notify_message_len']) ) . $lang['approve_notify_message_exceeded'] : $message;
                                                                $emailer->msg = stripslashes($emailer->msg);
                                                        }
                                                        $emailer->from($board_config['board_email']);
                                                        $emailer->replyto($board_config['board_email']);
                                                        $emailer->assign_vars(array());
                                                        $emailer->send();
                                                        $emailer->reset();
                                                }
                                                if ( intval($approve_mod['approve_notify_type']) == 1 )
                                                {
                                                        $script_name = preg_replace('/^\/?(.*?)\/?$/', "\\1", trim($board_config['script_path']));
                                                        $script_name = '/modules.php?name=Forums&file=viewtopic';
                                                        $server_name = trim($board_config['server_name']);
                                                        $server_protocol = ( $board_config['cookie_secure'] ) ? 'https://' : 'http://';
                                                        $server_port = ( $board_config['server_port'] <> 80 ) ? ':' . trim($board_config['server_port']) . '/' : '/';
                                                        $privmsg_subject = $lang['approve_notify_subject'] . " " . $post_id;
                                                        $privmsg_message = $lang['approve_notify_link'] . "\n" . $server_protocol . $server_name . $server_port . $script_name . '&'. POST_POST_URL . '=' . $post_id . '#' . $post_id;
                                                        if ( $approve_mod['approve_notify_message'] )
                                                        {
                                                                $privmsg_message .= "\n" . $lang['approve_notify_approve_link'] . "\n" . $server_protocol . $server_name . $server_port . $script_name . '&'. POST_POST_URL . '=' . $post_id . '&app_p=' . $post_id . '#' . $post_id;
                                                                $approve_post_max_length = ( $approve_mod['approve_notify_message_len'] > 10 ) ? $approve_mod['approve_notify_message_len'] : 10;
                                                                $privmsg_message .= "\n\n". $lang['approve_notify_message'] ."\n----------------------------\n";
                                                                $privmsg_message .= ( intval($approve_mod['approve_notify_message_len']) != 0 && (strlen($message) > intval($approve_mod['approve_notify_message_len']) ) ) ? substr($message, 0, intval($approve_mod['approve_notify_message_len']) ) . $lang['approve_notify_message_exceeded'] : $message;

                                                        }
                                                        $bbcode_uid = make_bbcode_uid();
                                                        $privmsg_message = prepare_message($privmsg_message, 1, 1, 1, $bbcode_uid);
                                                        $msg_time = time();
                                                        //
                                                        // See if recipient is at their inbox limit
                                                        //
                                                        $sql = "SELECT COUNT(privmsgs_id) AS inbox_items, MIN(privmsgs_date) AS oldest_post_time 
                                                                FROM " . PRIVMSGS_TABLE . " 
                                                                WHERE ( privmsgs_type = " . PRIVMSGS_NEW_MAIL . " 
                                                                                OR privmsgs_type = " . PRIVMSGS_READ_MAIL . " 
                                                                                OR privmsgs_type = " . PRIVMSGS_UNREAD_MAIL . " ) 
                                                                        AND privmsgs_to_userid = " . intval($approve_mod['moderators'][$i]);
                                                        if ( !($result = $db->sql_query($sql)) )
                                                        {
                                                                message_die(GENERAL_MESSAGE, $lang['No_such_user']);
                                                        }
                                                        $sql_priority = ( SQL_LAYER == 'mysql' ) ? 'LOW_PRIORITY' : '';
                                                        if ( $inbox_info = $db->sql_fetchrow($result) )
                                                        {
                                                                if ( intval($inbox_info['inbox_items']) >= intval($board_config['max_inbox_privmsgs']) && !empty($inbox_info['oldest_post_time']) )
                                                                {
                                                                        $sql = "SELECT privmsgs_id FROM " . PRIVMSGS_TABLE . " 
                                                                                WHERE ( privmsgs_type = " . PRIVMSGS_NEW_MAIL . " 
                                                                                                OR privmsgs_type = " . PRIVMSGS_READ_MAIL . " 
                                                                                                OR privmsgs_type = " . PRIVMSGS_UNREAD_MAIL . " ) 
                                                                                        AND privmsgs_date = " . $inbox_info['oldest_post_time'] . " 
                                                                                        AND privmsgs_to_userid = " . intval($approve_mod['moderators'][$i]);
                                                                        if ( !$result = $db->sql_query($sql) )
                                                                        {
                                                                                message_die(GENERAL_ERROR, 'Could not find oldest privmsgs (inbox)', '', __LINE__, __FILE__, $sql);
                                                                        }
                                                                        $old_privmsgs_id = $db->sql_fetchrow($result);
                                                                        $old_privmsgs_id = $old_privmsgs_id['privmsgs_id'];
                                                                        $sql = "DELETE $sql_priority FROM " . PRIVMSGS_TABLE . " 
                                                                                WHERE privmsgs_id = $old_privmsgs_id";
                                                                        if ( !$db->sql_query($sql) )
                                                                        {
                                                                                message_die(GENERAL_ERROR, 'Could not delete oldest privmsgs (inbox)'.$sql, '', __LINE__, __FILE__, $sql);
                                                                        }
                                                                        $sql = "DELETE $sql_priority FROM " . PRIVMSGS_TEXT_TABLE . " 
                                                                                WHERE privmsgs_text_id = $old_privmsgs_id";
                                                                        if ( !$db->sql_query($sql) )
                                                                        {
                                                                                message_die(GENERAL_ERROR, 'Could not delete oldest privmsgs text (inbox)', '', __LINE__, __FILE__, $sql);
                                                                        }
                                                                }
                                                        }
                                                        //
                                                        // Send the pm notification
                                                        //
                                                        $sql_info = "INSERT INTO " . PRIVMSGS_TABLE . " (privmsgs_type, privmsgs_subject, privmsgs_from_userid, privmsgs_to_userid, privmsgs_date, privmsgs_ip, privmsgs_enable_html, privmsgs_enable_bbcode, privmsgs_enable_smilies, privmsgs_attach_sig)
                                                                VALUES (" . PRIVMSGS_NEW_MAIL . ", '" . str_replace("\'", "''", $privmsg_subject) . "', " . intval($approve_mod['moderators'][$i]) . ", " . intval($approve_mod['moderators'][$i]) . ", $msg_time, '0.0.0.0', 1, 1, 1, 0)";
                                                        if ( !($result = $db->sql_query($sql_info, BEGIN_TRANSACTION)) )
                                                        {
                                                                message_die(GENERAL_ERROR, "Could not insert/update private message sent info.", "", __LINE__, __FILE__, $sql_info);
                                                        }
                                                        $privmsg_sent_id = $db->sql_nextid();
                                                        $sql = "INSERT INTO " . PRIVMSGS_TEXT_TABLE . " (privmsgs_text_id, privmsgs_bbcode_uid, privmsgs_text)
                                                                        VALUES ($privmsg_sent_id, '" . $bbcode_uid . "', '" . str_replace("\'", "''", $privmsg_message) . "')";
                                                        if ( !$db->sql_query($sql, END_TRANSACTION) )
                                                        {
                                                                message_die(GENERAL_ERROR, "Could not insert/update private message sent text.", "", __LINE__, __FILE__, $sql_info);
                                                        }
                                                        //
                                                        // Add to the users new pm counter
                                                        //
                                                        $sql = "UPDATE " . USERS_TABLE . " 
                                                                SET user_new_privmsg = user_new_privmsg + 1, user_last_privmsg = " . time() . " 
                                                                WHERE user_id = " . intval($approve_mod['moderators'][$i]);
                                                        if ( !$status = $db->sql_query($sql) )
                                                        {
                                                                message_die(GENERAL_ERROR, 'Could not update private message new/read status for user', '', __LINE__, __FILE__, $sql);
                                                        }
                                                        if ( $to_userdata['user_notify_pm'] && !empty($to_userdata['user_email']) && $to_userdata['user_active'] )
                                                        {
                                                                $email_headers = 'From: ' . $board_config['board_email'] . "\nReturn-Path: " . $board_config['board_email'] . "\n";

                                                                $script_name = preg_replace('/^\/?(.*?)\/?$/', "\\1", trim($board_config['script_path']));
                                                                $script_name = '/modules.php?name=Private_Messages&file=index';
                                                                $server_name = trim($board_config['server_name']);
                                                                $server_protocol = ( $board_config['cookie_secure'] ) ? 'https://' : 'http://';
                                                                $server_port = ( $board_config['server_port'] <> 80 ) ? ':' . trim($board_config['server_port']) . '/' : '/';

                                                                if ( !class_exists('emailer') )
                                                                {
                                                                        include_once('includes/emailer.'.$phpEx);
                                                                }
                                                                $emailer = new emailer($board_config['smtp_delivery']);
                                                                $emailer->from($board_config['board_email']);
                                                                $emailer->replyto($board_config['board_email']);
                                                                $emailer->use_template('privmsg_notify', $to_userdata['user_lang']);
                                                                $emailer->extra_headers($email_headers);
                                                                $emailer->email_address($to_userdata['user_email']);
                                                                $emailer->set_subject($lang['Notification_subject']);

                                                                $emailer->assign_vars(array(
                                                                        'USERNAME' => $to_username,
                                                                        'SITENAME' => $board_config['sitename'],
                                                                        'EMAIL_SIG' => (!empty($board_config['board_email_sig'])) ? str_replace('<br />', "\n", "-- \n" . $board_config['board_email_sig']) : '',

                                                                        'U_INBOX' => $server_protocol . $server_name . $server_port . $script_name . '&folder=inbox')
                                                                );

                                                                $emailer->send();
                                                                $emailer->reset();
                                                        }
                                                }
                                        }
                                }//moderator notification
                        }
                }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
                        /*--FNA #5--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                        if ( $approve_mod['enabled'] || $approve_mod['quoted_post_not_approved'] )
                        {
                                $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                                        WHERE post_id = " . intval($post_id) . " 
                                                AND is_post = 1";
                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                {
                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                }
                                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                {
                                        // post_id belongs to a post, that has to be approved, so
                                        // we delete quoted message and subject.
                                        $subject = '';
                                        $message = '';
                                }
                        }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
/*--FNA #6--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
if ( $approve_mod['enabled'] )
{
        if ( $mode != 'newtopic' && !($mode == 'editpost' && $post_data['first_post']) )
        {
                $template->assign_block_vars('switch_type_toggle', array());
        }
        $topic_type_toggle = $topic_type_toggle . "<br /><span class='copyright'><strong>" . $lang['approve_notify_poster'] . "</strong></span>";
}
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
modules/Forums/search.php

#
#-----[ FIND ]-----------------------------------------
#
                /*--FNA #1--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                                $approve_mod = array();
                                $approve_sql = "SELECT * FROM " . APPROVE_FORUMS_TABLE . " 
                                        WHERE forum_id = " .  intval($searchset[$i]['forum_id']) . " 
                                        LIMIT 0,1";
                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                {
                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                }
                                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                {
                                        if ( intval($approve_row['enabled']) == 1 )
                                        {
                                                $approve_mod = $approve_row;
                                                $approve_mod['enabled'] = true;
                                        }
                                }
                                if ( $approve_mod['enabled'] )
                                {
                                        $approve_mod['moderators'] = array();
                                        $approve_mod['moderators'] = explode('|', $approve_mod['approve_moderators']);
                                        if ( intval($approve_forum_id) != intval($searchset[$i]['forum_id']) )
                                        {
                                                $approve_forum_id = $searchset[$i]['forum_id'];
                                                $sql = "SELECT * FROM " . FORUMS_TABLE . " 
                                                        WHERE forum_id = " . intval($searchset[$i]['forum_id']) . " 
                                                        LIMIT 0,1";
                                                if ( !($result = $db->sql_query($sql)) )
                                                {
                                                        message_die(GENERAL_ERROR, 'Could not obtain forums information', '', __LINE__, __FILE__, $sql);
                                                }
                                                $forum_row = $db->sql_fetchrow($result);
                                        }
                                        $is_auth = array();
                                        $is_auth = auth(AUTH_ALL, $searchset[$i]['forum_id'], $userdata, $forum_row);

                                        $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                                                WHERE post_id = " . intval($searchset[$i]['post_id']) . " 
                                                LIMIT 0,1";
                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                        {
                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                        }
                                        if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                        {
                                                if ( intval($approve_row['post_id']) == intval($searchset[$i]['post_id']) )
                                                {
                                                        if ( !in_array($userdata['user_id'], $approve_mod['moderators']) && !$is_auth['auth_mod'] )
                                                        {
                                                                if ( $approve_mod['forum_hide_unapproved_posts'] && intval($approve_row['is_topic'] == 0) && intval($approve_row['is_post'] == 1) )
                                                                {
                                                                        continue;
                                                                }
                                                                elseif ( $approve_mod['forum_hide_unapproved_topics'] && intval($approve_row['is_topic']) == 1)
                                                                {
                                                                        continue;
                                                                }
                                                                else
                                                                {
                                                                        $post_subject = "[ " . $lang['approve_post_is_awaiting'] . " ]";
                                                                        $message = $post_subject;
                                                                        $topic_title =  (intval($approve_row['is_topic']) == 1) ? "[ " . $lang['approve_topic_is_awaiting'] . " ]" : $topic_title;
                                                                        $poster = ($searchset[$i]['user_id'] == ANONYMOUS) ? $lang['Guest'] : $poster;
                                                                }

                                                        }
                                                        else
                                                        {
                                                                $post_subject .= "</a></strong><br /><a href=\"" . append_sid("viewtopic." . $phpEx . "?". POST_POST_URL . "=" . $searchset[$i]['post_id'] . "&app_p=" . $searchset[$i]['post_id']) . "#" . $searchset[$i]['post_id'] . "\" class='copyright'>[ " . $lang['approve_post_approve'] . " ]";
                                                        }
                                                }
                                        }
                                }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
                /*--FNA #2--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                                $approve_mod = array();
                                $approve_sql = "SELECT * FROM " . APPROVE_FORUMS_TABLE . " 
                                        WHERE forum_id = " . intval($searchset[$i]['forum_id']) . " 
                                        LIMIT 0,1";
                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                {
                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                }
                                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                {
                                        if ( intval($approve_row['enabled']) == 1 )
                                        {
                                                $approve_mod = $approve_row;
                                                $approve_mod['enabled'] = true;
                                        }
                                }
                                if ( $approve_mod['enabled'] )
                                {
                                        $approve_mod['moderators'] = array();
                                        $approve_mod['moderators'] = explode('|', $approve_mod['approve_moderators']);
                                        if ( $approve_forum_id != $searchset[$i]['forum_id'] )
                                        {
                                                $approve_forum_id = $searchset[$i]['forum_id'];
                                                $sql = "SELECT * FROM " . FORUMS_TABLE . " 
                                                        WHERE forum_id = " . intval($searchset[$i]['forum_id']) . " 
                                                        LIMIT 0,1";
                                                if ( !($result = $db->sql_query($sql)) )
                                                {
                                                        message_die(GENERAL_ERROR, 'Could not obtain forums information', '', __LINE__, __FILE__, $sql);
                                                }
                                                $forum_row = $db->sql_fetchrow($result);
                                        }
                                        $is_auth = array();
                                        $is_auth = auth(AUTH_ALL, $searchset[$i]['forum_id'], $userdata, $forum_row);

                                        $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                                                WHERE post_id = " . intval($searchset[$i]['topic_first_post_id']) . " 
                                                LIMIT 0,1";
                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                        {
                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                        }
                                        if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                        {
                                                if ( intval($approve_row['post_id']) == intval($searchset[$i]['topic_first_post_id']) )
                                                {
                                                        if ( !in_array($userdata['user_id'], $approve_mod['moderators']) && !$is_auth['auth_mod'] )
                                                        {
                                                                if ( $approve_mod['forum_hide_unapproved_topics'] && intval($approve_row['is_topic']) == 1)
                                                                {
                                                                        continue;
                                                                }
                                                                else
                                                                {
                                                                        $topic_title = "[ " . $lang['approve_topic_is_awaiting'] . " ]";
                                                                        $message = $topic_title;
                                                                        $topic_author = ($searchset[$i]['user_id'] == ANONYMOUS) ? $lang['Guest'] . ' ' : $topic_author;
                                                                        $last_post_author = ( $searchset[$i]['id2'] == ANONYMOUS ) ? ( $lang['Guest'] . ' ' ) : $last_post_author;
                                                                }
                                                        }
                                                        else
                                                        {
                                                                $topic_title .= "</a><br /><a href=\"" . append_sid("viewtopic." . $phpEx . "?t=" . $searchset[$i]['topic_id'] ) . "\" class='copyright'>[ " . $lang['approve_topic_is_awaiting'] . " ]";
                                                        }
                                                }
                                        }
                                        elseif ( in_array($userdata['user_id'], $approve_mod['moderators']) || $is_auth['auth_mod'] )
                                        {
                                                $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                                                        WHERE topic_id = " . intval($searchset[$i]['topic_id']) . " 
                                                                AND is_post = 1 
                                                        ORDER BY post_id 
                                                        LIMIT 0,2";
                                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                {
                                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                                }
                                                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                                {
                                                        if ( $db->sql_numrows($approve_result) >= 1 )
                                                        {
                                                                $topic_title .= "</a><br /><a href=\"" . append_sid("viewtopic." . $phpEx . "?p=" . $approve_row['post_id'] ) . "#" . $approve_row['post_id'] . "\" class='copyright'>[ " . $lang['approve_topic_has_awaiting'] . " ]";
                                                        }
                                                }
                                        }
                                }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
modules/Forums/viewforum.php

#
#-----[ FIND ]-----------------------------------------
#
/*--FNA #1--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
$approve_mod = array();
$approve_sql = "SELECT * FROM " . APPROVE_FORUMS_TABLE . " 
        WHERE forum_id = " . intval($forum_id);
if ( !($approve_result = $db->sql_query($approve_sql)) )
{
        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
}
if ( $approve_row = $db->sql_fetchrow($approve_result) )
{
        if ( intval($approve_row['enabled']) == 1 )
        {
                $approve_mod = $approve_row;
                $approve_mod['enabled'] = true;
        }
}
$approve_mod['moderators'] = array();
$approve_mod['moderators'] = explode('|', $approve_mod['approve_moderators']);
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
                /*--FNA #2--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                $news_label = ( $topic_rowset[$i]['news_id'] > 0 ) ? $lang['News'] . ': ' : '';
                if ( $approve_mod['enabled'] )
                {
                        $approve_mod['topics_awaiting'] = false;
                        $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                                WHERE topic_id = " . intval($topic_id) . " 
                                        AND is_topic = 1 
                                LIMIT 0,1";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                        }
                        if ( $approve_row = $db->sql_fetchrow($approve_result) )
                        {
                                if ( intval($approve_row['is_topic']) == 1 )
                                {
                                        $approve_mod['topics_awaiting'] = true;
                                }
                        }

                        if ( in_array($userdata['user_id'], $approve_mod['moderators']) || $is_auth['auth_mod'] )
                        {
                                if ( $approve_mod['topics_awaiting'] )
                                {
                                        $topic_title .= "</a><br /><a href=\"" . append_sid("viewtopic." . $phpEx . "?t=" . $topic_id ) . "\" class='copyright'>[ " . $lang['approve_topic_is_awaiting'] . " ]";
                                }
                                else
                                {
                                        $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                                                WHERE topic_id = " . intval($topic_id) . " 
                                                        AND is_post = 1 
                                                ORDER BY post_id 
                                                LIMIT 0,2";
                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                        {
                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                        }
                                        if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                        {
                                                if ( $db->sql_numrows($approve_result) >= 1 )
                                                {
                                                        $topic_title .= "</a><br /><a href=\"" . append_sid("viewtopic." . $phpEx . "?p=" . $approve_row['post_id'] ) . "#" . $approve_row['post_id'] . "\" class='copyright'>[ " . $lang['approve_topic_has_awaiting'] . " ]";
                                                }
                                        }
                                }
                        }
                        else
                        {
                                if ( $approve_mod['topics_awaiting'] )
                                {
                                        if ( $approve_mod['forum_hide_unapproved_topics'] )
                                        {
                                                continue;
                                        }
                                        $topic_title = "</a><span class='copyright'>[ " . $lang['approve_topic_is_awaiting'] . " ]</span>";
                                        $view_topic_url = append_sid("viewforum.php?f=" . $forum_id );
                                        $last_post_url = $last_post_url = '<img src="' . $images['icon_latest_reply'] . '" alt="' . $lang['View_latest_post'] . '" title="' . $lang['View_latest_post'] . '" border="0" />';
                                        $goto_page = '';
                                        $last_post_author = ( intval($topic_rowset[$i]['id2']) == intval(ANONYMOUS) ) ? $lang['Guest'] : $last_post_author;
                                        $topic_author = ( intval($topic_rowset[$i]['user_id']) == intval(ANONYMOUS) ) ? $lang['Guest'] : $topic_author;
                                }
                                else
                                {
                                        $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                                                WHERE post_id = " . intval($topic_rowset[$i]['topic_last_post_id']) . " 
                                                AND is_post = 1 
                                                LIMIT 0,1";
                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                        {
                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                        }
                                        $approve_row = $db->sql_fetchrow($approve_result);
                                        if ( intval($approve_row['post_id']) == intval($topic_rowset[$i]['topic_last_post_id']) )
                                        {
                                                if ( $approve_mod['forum_hide_unapproved_posts'] )
                                                {
                                                        $approve_sql = "SELECT p.post_id, p.poster_id, p.post_time, p.post_username, u.username 
                                                                FROM " . POSTS_TABLE . " p, " . APPROVE_POSTS_TABLE . " a, " . USERS_TABLE . " u 
                                                                WHERE a.post_id = " . intval($topic_rowset[$i]['topic_last_post_id']) . " 
                                                                AND p.topic_id = a.topic_id 
                                                                AND u.user_id = p.poster_id 
                                                                ORDER BY p.post_time DESC";
                                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                        {
                                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                                        }
                                                        while( $approve_row = $db->sql_fetchrow($approve_result) )
                                                        {
                                                                $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                                                                        WHERE post_id = " . intval($approve_row['post_id']) . " 
                                                                        LIMIT 0,1";
                                                                if ( !($approve_result2 = $db->sql_query($approve_sql)) )
                                                                {
                                                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                                                }
                                                                $approve_row2 = $db->sql_fetchrow($approve_result2);
                                                                if ( !$approve_row2['post_id'] )
                                                                {
                                                                        $last_post_time = create_date($board_config['default_dateformat'], $approve_row['post_time'], $board_config['board_timezone']);

                                                                        $last_post_author = ( $approve_row['poster_id'] == ANONYMOUS ) ? ( ($approve_row['post_username'] != '' ) ? $approve_row['post_username'] . ' ' : $lang['Guest'] . ' ' ) : '<a href="' . append_sid("profile.$phpEx?mode=viewprofile&amp;" . POST_USERS_URL . '='  . $approve_row['poster_id']) . '">' . $approve_row['username'] . '</a>';

                                                                        $last_post_url = '<a href="' . append_sid("viewtopic.$phpEx?"  . POST_POST_URL . '=' . $approve_row['post_id']) . '#' . $approve_row['post_id'] . '"><img src="' . $images['icon_latest_reply'] . '" alt="' . $lang['View_latest_post'] . '" title="' . $lang['View_latest_post'] . '" border="0" /></a>';
                                                                        break;
                                                                }
                                                        }
                                                }
                                                else
                                                {
                                                        $last_post_author = ( intval($topic_rowset[$i]['id2']) == intval(ANONYMOUS) ) ? $lang['Guest'] : $last_post_author;
                                                }
                                        }
                                }
                        }
                }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
                        /*--FNA #3--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                        'L_NEWS' => $news_label,
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
modules/Forums/viewtopic.php

#
#-----[ FIND ]-----------------------------------------
#
        /*--FNA #1--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
}       //end of: if ( !empty($forum_topic_data['topic_vote']) )
        //ends the 'Does this topic contain a poll?' (instead of doing a replace, we redid the if on the bottom of this 'after, add'

$approve_mod = array();
$approve_sql = "SELECT * FROM " . APPROVE_FORUMS_TABLE . " 
        WHERE forum_id = " . intval($forum_id) . " 
        LIMIT 0,1";
if ( !($approve_result = $db->sql_query($approve_sql)) )
{
        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
}
if ( $approve_row = $db->sql_fetchrow($approve_result) )
{
        if ( intval($approve_row['enabled']) == 1 )
        {
                $approve_mod = $approve_row;
                $approve_mod['enabled'] = true;
        }

}
$approve_mod['moderators'] = array();
$approve_mod['moderators'] = explode('|', $approve_mod['approve_moderators']);

if ( $approve_mod['enabled'] )
{
        if ( in_array($userdata['user_id'], $approve_mod['moderators']) || $is_auth['auth_mod'] )
        {
                function approve_mod_pm($type, $id)
                {
                        global $approve_mod, $userdata, $user_ip, $session_length, $starttime, $template, $images, $theme, $db, $board_config, $phpEx, $lang, $phpbb_root_path, $html_entities_match, $html_entities_replace, $unhtml_specialchars_match, $unhtml_specialchars_replace;

                        if ( $approve_mod['approve_notify_approval'] )
                        {
                                $server_name = trim($board_config['server_name']);
                                $server_protocol = ( $board_config['cookie_secure'] ) ? 'https://' : 'http://';
                                $server_port = ( $board_config['server_port'] <> 80 ) ? ':' . trim($board_config['server_port']) . '/' : '/';
                                $script_name = preg_replace('/^\/?(.*?)\/?$/', "\\1", trim($board_config['script_path']));
                                $script_name = '/modules.php?name=Forums&file=viewtopic';
                                if ( !class_exists('emailer') )
                                {
                                        @include_once('includes/emailer.'.$phpEx);
                                }
                                @include_once('includes/functions_post.'.$phpEx);
                                if ( $type == 'app_p' )
                                {
                                        //notify user of post approval
                                        $approve_sql = "SELECT u.*, p.poster_id FROM " . USERS_TABLE . " u, " . APPROVE_POSTS_TABLE . " p 
                                                WHERE p.post_id = " .  intval($id) . " 
                                                        AND u.user_id = p.poster_id";
                                        if ( !$approve_result = $db->sql_query($approve_sql) )
                                        {
                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                        }
                                        if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                        {
                                                $approve_to[0] = $approve_row;
                                        }
                                        $privmsg_subject = $lang['approve_notify_post_approved'] . " " . $lang['Post'] . ": " . $id;
                                        $privmsg_message = $lang['approve_notify_user_link'] . "\n" . $server_protocol . $server_name . $server_port . $script_name . '&'. POST_POST_URL . '=' . $id . '#' . $id;
                                }
                                elseif ( $type == 'app_c' )
                                {
                                        //notify user of post approval
                                        $approve_sql = "SELECT u.*, p.post_id, p.topic_id FROM " . USERS_TABLE . " u, " . APPROVE_POSTS_TABLE . " p WHERE p.topic_id = " . intval($id) . " 
                                                        AND u.user_id = p.poster_id";
                                        if ( !$approve_result = $db->sql_query($approve_sql) )
                                        {
                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                        }
                                        if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                        {
                                                $approve_to[0] = $approve_row;
                                        }
                                        $privmsg_subject = $lang['approve_notify_post_approved'] . " " . $lang['Topic'] . ": " . $id;
                                        $privmsg_message = $lang['approve_notify_user_link'] . "\n" . $server_protocol . $server_name . $server_port . $script_name . '&'. POST_POST_URL . '=' . $approve_to[0]['post_id'] . '#' . $approve_to[0]['post_id'] . "\n\n" .  $lang['approve_notify_user_topic'];
                                }
                                else
                                {
                                        $approve_sql = "SELECT * FROM " . USERS_TABLE . " 
                                                WHERE user_id = " . intval($id);
                                        if ( !$approve_result = $db->sql_query($approve_sql) )
                                        {
                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql); 
                                        }
                                        if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                        {
                                                $approve_to[0] = $approve_row;
                                        }
                                        switch($type)
                                        {
                                                case 'app_ua':
                                                        $privmsg_subject = $lang['approve_notify_auto_app'];
                                                        $privmsg_message = $lang['approve_notify_auto_app_msg'];
                                                break;

                                                case 'app_ur':
                                                        $privmsg_subject = $lang['approve_notify_auto_app_rem'];
                                                        $privmsg_message = $lang['approve_notify_auto_app_rem_msg'];
                                                break;

                                                case 'app_ma':
                                                        $privmsg_subject = $lang['approve_notify_moderation'];
                                                        $privmsg_message = $lang['approve_notify_moderation_msg'];
                                                break;

                                                case 'app_mr':
                                                        $privmsg_subject = $lang['approve_notify_moderation_rem'];
                                                        $privmsg_message = $lang['approve_notify_moderation_rem_msg'];
                                                break;
                                        }
                                }
                                $approve_user_list = array();
                                for($i = 0; !empty($approve_to[$i]['user_id']); $i++)
                                {
                                        if ( $approve_to[$i]['user_id'] != ANONYMOUS && !in_array($approve_to[$i]['user_id'], $approve_user_list) )
                                        {
                                                $approve_user_list[] = $approve_to[$i]['user_id'];

                                                $bbcode_uid = make_bbcode_uid();
                                                $privmsg_message = prepare_message($privmsg_message, 1, 1, 1, $bbcode_uid);
                                                $msg_time = time();
                                                //
                                                // See if recipient is at their inbox limit
                                                //
                                                $sql = "SELECT COUNT(privmsgs_id) AS inbox_items, MIN(privmsgs_date) AS oldest_post_time 
                                                        FROM " . PRIVMSGS_TABLE . " 
                                                        WHERE ( privmsgs_type = " . PRIVMSGS_NEW_MAIL . " 
                                                                        OR privmsgs_type = " . PRIVMSGS_READ_MAIL . " 
                                                                        OR privmsgs_type = " . PRIVMSGS_UNREAD_MAIL . " ) 
                                                                AND privmsgs_to_userid = " . intval($approve_to[$i]['user_id']);
                                                if ( !($result = $db->sql_query($sql)) )
                                                {
                                                        return false;
                                                }
                                                $sql_priority = ( SQL_LAYER == 'mysql' ) ? 'LOW_PRIORITY' : '';
                                                if ( $inbox_info = $db->sql_fetchrow($result) )
                                                {
                                                        if ( $inbox_info['inbox_items'] >= $board_config['max_inbox_privmsgs'] && !empty($inbox_info['oldest_post_time']) )
                                                        {
                                                                $sql = "SELECT privmsgs_id FROM " . PRIVMSGS_TABLE . " 
                                                                        WHERE ( privmsgs_type = " . PRIVMSGS_NEW_MAIL . " 
                                                                                        OR privmsgs_type = " . PRIVMSGS_READ_MAIL . " 
                                                                                        OR privmsgs_type = " . PRIVMSGS_UNREAD_MAIL . " ) 
                                                                                AND privmsgs_date = " . $inbox_info['oldest_post_time'] . " 
                                                                                AND privmsgs_to_userid = " . intval($approve_to[$i]['user_id']);
                                                                if ( !$result = $db->sql_query($sql) )
                                                                {
                                                                        message_die(GENERAL_ERROR, 'Could not find oldest privmsgs (inbox)', '', __LINE__, __FILE__, $sql);
                                                                }
                                                                $old_privmsgs_id = $db->sql_fetchrow($result);
                                                                $old_privmsgs_id = $old_privmsgs_id['privmsgs_id'];
                                                                $sql = "DELETE $sql_priority FROM " . PRIVMSGS_TABLE . " 
                                                                        WHERE privmsgs_id = $old_privmsgs_id";
                                                                if ( !$db->sql_query($sql) )
                                                                {
                                                                        message_die(GENERAL_ERROR, 'Could not delete oldest privmsgs (inbox)'.$sql, '', __LINE__, __FILE__, $sql);
                                                                }
                                                                $sql = "DELETE $sql_priority FROM " . PRIVMSGS_TEXT_TABLE . " 
                                                                        WHERE privmsgs_text_id = $old_privmsgs_id";
                                                                if ( !$db->sql_query($sql) )
                                                                {
                                                                        message_die(GENERAL_ERROR, 'Could not delete oldest privmsgs text (inbox)', '', __LINE__, __FILE__, $sql);
                                                                }
                                                        }
                                                }
                                                //
                                                // Send the pm notification
                                                //
                                                $sql_info = "INSERT INTO " . PRIVMSGS_TABLE . " (privmsgs_type, privmsgs_subject, privmsgs_from_userid, privmsgs_to_userid, privmsgs_date, privmsgs_ip, privmsgs_enable_html, privmsgs_enable_bbcode, privmsgs_enable_smilies, privmsgs_attach_sig) 
                                                        VALUES (" . PRIVMSGS_NEW_MAIL . ", '" . str_replace("'", "\'", $privmsg_subject) . "', " . intval($approve_to[$i]['user_id']) . ", " . intval($approve_to[$i]['user_id']) . ", $msg_time, '0.0.0.0', 1, 1, 1, 0)";
                                                if ( !($result = $db->sql_query($sql_info, BEGIN_TRANSACTION)) )
                                                {
                                                        message_die(GENERAL_ERROR, "Could not insert/update private message sent info.", "", __LINE__, __FILE__, $sql_info);
                                                }
                                                $privmsg_sent_id = $db->sql_nextid();
                                                $sql = "INSERT INTO " . PRIVMSGS_TEXT_TABLE . " (privmsgs_text_id, privmsgs_bbcode_uid, privmsgs_text) 
                                                                VALUES ($privmsg_sent_id, '" . $bbcode_uid . "', '" . str_replace("'", "\'", $privmsg_message) . "')";
                                                if ( !$db->sql_query($sql, END_TRANSACTION) )
                                                {
                                                        message_die(GENERAL_ERROR, "Could not insert/update private message sent text.", "", __LINE__, __FILE__, $sql_info);
                                                }
                                                //
                                                // Add to the users new pm counter
                                                //
                                                $sql = "UPDATE " . USERS_TABLE . " 
                                                        SET user_new_privmsg = user_new_privmsg + 1, user_last_privmsg = " . time() . " 
                                                        WHERE user_id = " . intval($approve_to[$i]['user_id']);
                                                if ( !$status = $db->sql_query($sql) )
                                                {
                                                        message_die(GENERAL_ERROR, 'Could not update private message new/read status for user', '', __LINE__, __FILE__, $sql);
                                                }
                                                //
                                                // E-mail notify the user of the new PM if they have email notification for PM enabled in profile
                                                //
                                                if ( $approve_to[$i]['user_notify_pm'] && !empty($approve_to[$i]['user_email']) && $approve_to[$i]['user_active'] )
                                                {
                                                        $email_headers = 'From: ' . $board_config['board_email'] . "\nReturn-Path: " . $board_config['board_email'] . "\n";
                                                        $script_name = preg_replace('/^\/?(.*?)\/?$/', "\\1", trim($board_config['script_path']));
                                                        $script_name = '/modules.php?name=Private_Messages&file=index';
                                                        $emailer = new emailer($board_config['smtp_delivery']);
                                                        $emailer->use_template('privmsg_notify',$approve_to[$i]['user_lang']);
                                                        $emailer->extra_headers($email_headers);
                                                        $emailer->email_address($approve_to[$i]['user_email']);
                                                        $emailer->set_subject($lang['Notification_subject']);
                                                        $emailer->assign_vars(array(
                                                                'USERNAME' => $approve_to[$i]['username'], 
                                                                'SITENAME' => $board_config['sitename'],
                                                                'EMAIL_SIG' => (!empty($board_config['board_email_sig'])) ? str_replace('<br />', "\n", "-- \n" . $board_config['board_email_sig']) : '',
                                                                'U_INBOX' => $server_protocol . $server_name . $server_port . $script_name . '&folder=inbox')
                                                        );
                                                        $emailer->send();
                                                        $emailer->reset();
                                                }
                                        }//if not guest or we've already notified them once
                                }//for loop
                        }
                }//function approve_mod_pm
                
                if ( isset($HTTP_GET_VARS['app_p']) )
                {
                        //notify user
                        approve_mod_pm('app_p', intval($HTTP_GET_VARS['app_p']));
                        $approve_sql = "DELETE FROM " . APPROVE_POSTS_TABLE . " 
                                WHERE post_id = " . intval($HTTP_GET_VARS['app_p']);
                        if ( !($approve_result = $db->sql_query($approve_sql)) ) 
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $approve_sql);
                        }
                }
                if ( isset($HTTP_GET_VARS['app_c']) )
                {
                        //loop through & notify users
                        approve_mod_pm('app_c', intval($HTTP_GET_VARS['app_c']));
                        $approve_sql = "DELETE FROM " . APPROVE_POSTS_TABLE . " 
                                WHERE topic_id = " . intval($HTTP_GET_VARS['app_c']);
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $approve_sql);
                        }
                }
                if ( isset($HTTP_GET_VARS['app_f']) )
                {
                        $approve_sql = "DELETE FROM " . APPROVE_TOPICS_TABLE . " 
                                WHERE topic_id = " . intval($HTTP_GET_VARS['app_f']);
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $approve_sql);
                        }
                        $approve_sql = "INSERT INTO " . APPROVE_TOPICS_TABLE . " (topic_id, approve_moderate) 
                                VALUES (" . intval($HTTP_GET_VARS['app_f']) . ", -1)";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_insert'], '', __LINE__, __FILE__, $approve_sql);
                        }
                }
                if ( isset($HTTP_GET_VARS['app_r']) )
                {
                        $approve_sql = "DELETE FROM " . APPROVE_TOPICS_TABLE . " 
                                WHERE topic_id = " . intval($HTTP_GET_VARS['app_r']) . " 
                                        AND approve_moderate = -1";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $approve_sql);
                        }
                }
                if ( isset($HTTP_GET_VARS['app_ua']) )
                {
                        //pm notify user they're being auto-approved now
                        approve_mod_pm('app_ua', intval($HTTP_GET_VARS['app_ua']));
                        $approve_sql = "DELETE FROM " . APPROVE_USERS_TABLE . " 
                                WHERE user_id = " . intval($HTTP_GET_VARS['app_ua']); 
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $approve_sql);
                        }
                        $approve_sql = "INSERT INTO " . APPROVE_USERS_TABLE . " (user_id, approve_moderate) 
                                VALUES (" . intval($HTTP_GET_VARS['app_ua']) . ", -1)";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_insert'], '', __LINE__, __FILE__, $approve_sql);
                        }
                        $approve_sql = "DELETE FROM " . APPROVE_POSTS_TABLE . " 
                                WHERE poster_id = " . intval($HTTP_GET_VARS['app_ua']);
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $approve_sql);
                        }
                }
                if ( isset($HTTP_GET_VARS['app_ur']) )
                {
                        //pm notify user they're no longer being auto-approved
                        approve_mod_pm('app_ur', intval($HTTP_GET_VARS['app_ur']));
                        $approve_sql = "DELETE FROM " . APPROVE_USERS_TABLE . " 
                                WHERE user_id = " . intval($HTTP_GET_VARS['app_ur']) . " 
                                        AND approve_moderate = -1";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $approve_sql);
                        }
                }
                if ( isset($HTTP_GET_VARS['app_ma']) )
                {
                        //pm notify user they're being moderated now
                        approve_mod_pm('app_ma', intval($HTTP_GET_VARS['app_ma']));
                        $approve_sql = "DELETE FROM " . APPROVE_USERS_TABLE . " 
                                WHERE user_id = " . intval($HTTP_GET_VARS['app_ma']);
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $approve_sql);
                        }
                        $approve_sql = "INSERT INTO " . APPROVE_USERS_TABLE . " (user_id, approve_moderate) 
                                VALUES (" . intval($HTTP_GET_VARS['app_ma']) . ", 1)";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_insert'], '', __LINE__, __FILE__, $approve_sql);
                        }
                }
                if ( isset($HTTP_GET_VARS['app_mr']) )
                {
                        //pm notify user they're not longer being moderated
                        approve_mod_pm('app_mr', intval($HTTP_GET_VARS['app_mr']));
                        $approve_sql = "DELETE FROM " . APPROVE_USERS_TABLE . " 
                                WHERE user_id = " . intval($HTTP_GET_VARS['app_mr']) . " 
                                        AND approve_moderate = 1";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $approve_sql);
                        }
                }
                if ( isset($HTTP_GET_VARS['app_ta']) )
                {
                        //notify user
                        approve_mod_pm('app_p', intval($HTTP_GET_VARS['app_ta']));
                        $approve_sql = "DELETE FROM " . APPROVE_TOPICS_TABLE . " 
                                WHERE topic_id = " . intval($HTTP_GET_VARS['app_ta']);
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $approve_sql);
                        }
                        $approve_sql = "INSERT INTO " . APPROVE_TOPICS_TABLE . " (topic_id, approve_moderate) 
                                VALUES (" . intval($HTTP_GET_VARS['app_ta']) . ", 1)";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_insert'], '', __LINE__, __FILE__, $approve_sql);
                        }
                }
                if ( isset($HTTP_GET_VARS['app_tr']) )
                {
                        //notify user
                        approve_mod_pm('app_p', intval($HTTP_GET_VARS['app_tr']));
                        $approve_sql = "DELETE FROM " . APPROVE_TOPICS_TABLE . " 
                                WHERE topic_id = " . intval($HTTP_GET_VARS['app_tr']) . " 
                                        AND approve_moderate = 1";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $approve_sql);
                        }
                }
                //if the topic is awaiting approval, notify mod user to approve this topic
                $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                        WHERE topic_id = " . intval($topic_id) . " 
                                AND is_topic = 1 
                        LIMIT 0,1";
                if ( !($approve_result = $db->sql_query($approve_sql)) )
                {
                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                }
                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                {
                        if ( intval($approve_row['is_topic']) == 1 )
                        {
                                $approve_mod['topics_admin_awaiting'] = true;
                        }
                }
        }
        else
        {
                //if the topic is awaiting approval, notify non-mod user
                $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                        WHERE topic_id = " . intval($topic_id) . " 
                                AND is_topic = 1 
                        LIMIT 0,1";
                if ( !($approve_result = $db->sql_query($approve_sql)) )
                {
                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                }
                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                {
                        if ( intval($approve_row['is_topic']) == 1 )
                        {
                                $approve_mod['topics_awaiting'] = true;
                        }
                }
        }
}

        //resetting up the if statement for polls, and modifying to hide polls when topic isn't approved yet.

//
// Does this topic contain a poll?
//
if ( !empty($forum_topic_data['topic_vote']) && !$approve_mod['topics_awaiting'] )
{
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
        /*--FNA #2--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
        $delim = htmlspecialchars( '<!--break-->' );
        $pos = strpos( $message, $delim );
        if( ($pos !== false) && ($pos < strlen( $message )) ) {
                $message = substr_replace( $message, html_entity_decode($delim), $pos, strlen($delim) );
        }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
    /*--FNA #3--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                if ( $approve_mod['enabled'] )
                {
                        $approve_mod['poster_id'] = $postrow[$i]['poster_id'];
                        $approve_mod['posts_awaiting'] = false;

                        $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . "
                                WHERE post_id = " . intval($postrow[$i]['post_id']) . " 
                                LIMIT 0,1";
                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                        }
                        if ( $approve_row = $db->sql_fetchrow($approve_result) )
                        {
                                if ( intval($approve_row['post_id']) == intval($postrow[$i]['post_id']) )
                                {
                                        $approve_mod['posts_awaiting'] = true;
                                }
                        }
                        $approve_mod['moderators'] = array();
                        $approve_mod['moderators'] = explode('|', $approve_mod['approve_moderators']);

                        if ( in_array($userdata['user_id'], $approve_mod['moderators']) || $is_auth['auth_mod'] )
                        {
                                if ( !$approve_mod['approve_first_past'] )
                                {
                                        $approve_mod['approve_first_past'] = true;
                                        $approve_sql = "SELECT * FROM " . APPROVE_POSTS_TABLE . " 
                                                WHERE topic_id = " . intval($topic_id) . " 
                                                LIMIT 0,2";
                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                        {
                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                        }
                                        if ( $db->sql_numrows($approve_result) > 1)
                                        {
                                                $post_subject .= "<br /><a href=\"" . append_sid("viewtopic." . $phpEx . "?". POST_TOPIC_URL . "=" . $topic_id . "&app_c=" . $topic_id) . "\" class='copyright'>[ " . $lang['approve_topic_all_current'] . " ]</a>";
                                        }
                                        if ( $approve_mod['approve_users'] )
                                        {
                                                $approve_sql = "SELECT * FROM " . APPROVE_TOPICS_TABLE . " 
                                                        WHERE topic_id = " . intval($topic_id) . " 
                                                                AND approve_moderate = -1 
                                                        LIMIT 0,1";
                                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                {
                                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                                }
                                                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                                {
                                                        $post_subject .= "<br /><a href=\"" . append_sid("viewtopic." . $phpEx . "?". POST_TOPIC_URL . "=" . $topic_id . "&app_r=" . $topic_id) . "\" class='copyright'>[ " . $lang['approve_topic_all_future_rem'] . " ]</a>";
                                                }
                                                else
                                                {
                                                        $post_subject .= "<br /><a href=\"" . append_sid("viewtopic." . $phpEx . "?". POST_TOPIC_URL . "=" . $topic_id . "&app_f=" . $topic_id) . "\" class='copyright'>[ " . $lang['approve_topic_all_future'] . " ]</a>";
                                                }
                                        }
                                        else if ( $approve_mod['approve_topics'] && $approve_mod['approve_posts'] )
                                        {
                                                $approve_sql = "SELECT * FROM " . APPROVE_TOPICS_TABLE . " 
                                                        WHERE topic_id = " . intval($topic_id) . " 
                                                                AND approve_moderate = 1";
                                                if ( !($approve_result = $db->sql_query($approve_sql)) )
                                                {
                                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                                }
                                                if ( $approve_row = $db->sql_fetchrow($approve_result) )
                                                {
                                                        $post_subject .= "<br /><a href=\"" . append_sid("viewtopic." . $phpEx . "?". POST_TOPIC_URL . "=" . $topic_id . "&app_tr=" . $topic_id) . "\" class='copyright'>[ " . $lang['approve_topic_moderate_rem'] . " ]</a>";
                                                }
                                                else
                                                {
                                                        $post_subject .= "<br /><a href=\"" . append_sid("viewtopic." . $phpEx . "?". POST_TOPIC_URL . "=" . $topic_id . "&app_ta=" . $topic_id) . "\" class='copyright'>[ " . $lang['approve_topic_moderate'] . " ]</a>";
                                                }
                                        }
                                }
                                if ( $approve_mod['approve_users'] && $approve_mod['poster_id'] != ANONYMOUS )
                                {
                                        $approve_sql = "SELECT * FROM " . APPROVE_USERS_TABLE . " 
                                                WHERE user_id = " . intval($approve_mod['poster_id']) . " 
                                                LIMIT 0,1";
                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                        {
                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                        }
                                        $approve_row = $db->sql_fetchrow($approve_result);
                                        if ( intval($approve_row['approve_moderate']) == -1 )
                                        {
                                                $poster_rank .= "<br /><a href=\"" .  append_sid("viewtopic." . $phpEx . "?". POST_POST_URL . "=" . $postrow[$i]['post_id'] . "&app_ur=" . $poster_id) . "#" . $postrow[$i]['post_id'] . "\" class='copyright'>[ " . $lang['approve_user_auto_approve_rem'] . " ]</a>";
                                        }
                                        elseif ( intval($approve_row['approve_moderate']) == 1 )
                                        {
                                                $poster_rank .= "<br /><a href=\"" .  append_sid("viewtopic." . $phpEx . "?". POST_POST_URL . "=" . $postrow[$i]['post_id'] . "&app_mr=" . $poster_id) . "#" . $postrow[$i]['post_id'] . "\" class='copyright'>[ " . $lang['approve_user_moderate_rem'] . " ]</a>";
                                        }
                                        else
                                        {

                                                //moderate all users, give option to auto approve this user
                                                $poster_rank .= "<br/ ><a href=\"" .  append_sid("viewtopic." . $phpEx . "?". POST_POST_URL . "=" . $postrow[$i]['post_id'] . "&app_ua=" . $poster_id) . "#" . $postrow[$i]['post_id'] . "\" class='copyright'>[ " . $lang['approve_user_auto_approve'] . " ]</a>";
                                        }
                                }
                                elseif ( $approve_mod['poster_id'] != -1 )
                                {
                                        $approve_sql = "SELECT * FROM " . APPROVE_USERS_TABLE . " 
                                                WHERE user_id = " . intval($approve_mod['poster_id']) . " 
                                                LIMIT 0,1";
                                        if ( !($approve_result = $db->sql_query($approve_sql)) )
                                        {
                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $approve_sql);
                                        }
                                        $approve_row = $db->sql_fetchrow($approve_result);
                                        if ( intval($approve_row['approve_moderate']) == 1 )
                                        {
                                                        $poster_rank .= "<br /><a href=\"" .  append_sid("viewtopic." . $phpEx . "?". POST_POST_URL . "=" . $postrow[$i]['post_id'] . "&app_mr=" . $poster_id) . "#" . $postrow[$i]['post_id'] . "\" class='copyright'>[ " . $lang['approve_user_moderate_rem'] . " ]</a>";
                                        }
                                        elseif ( intval($approve_row['approve_moderate']) == -1 )
                                        {
                                                        $poster_rank .= "<br /><a href=\"" .  append_sid("viewtopic." . $phpEx . "?". POST_POST_URL . "=" . $postrow[$i]['post_id'] . "&app_ur=" . $poster_id) . "#" . $postrow[$i]['post_id'] . "\" class='copyright'>[ " . $lang['approve_user_auto_approve_rem'] . " ]</a>";
                                        }
                                        else
                                        {
                                                $poster_rank .= "<br /><a href=\"" .  append_sid("viewtopic." . $phpEx . "?". POST_POST_URL . "=" . $postrow[$i]['post_id'] . "&app_ma=" . $poster_id) . "#" . $postrow[$i]['post_id'] . "\" class='copyright'>[ " . $lang['approve_user_moderate'] . " ]</a>";
                                        }
                                }
                                if ( $approve_mod['topics_admin_awaiting'] )
                                {
                                        $post_subject .= "<br /><a href=\"" . append_sid("viewtopic." . $phpEx . "?". POST_POST_URL . "=" . $postrow[$i]['post_id'] . "&app_p=" . $postrow[$i]['post_id']) . "#" . $postrow[$i]['post_id'] . "\" class='copyright'>[ " . $lang['approve_topic_approve'] . " ]</a>";
                                }
                                else
                                if ( $approve_mod['posts_awaiting'] )
                                {
                                        $post_subject .= "<br /><a href=\"" . append_sid("viewtopic." . $phpEx . "?". POST_POST_URL . "=" . $postrow[$i]['post_id'] . "&app_p=" . $postrow[$i]['post_id']) . "#" . $postrow[$i]['post_id'] . "\" class='copyright'>[ " . $lang['approve_post_approve'] . " ]</a>";
                                }
                        }
                        else
                        {
                                if ( $approve_mod['posts_awaiting'] )
                                {
                                        if ( $approve_mod['forum_hide_unapproved_posts'] && !$approve_mod['topics_awaiting'] )
                                        {
                                                continue;
                                        }
                                        $post_subject = "[ " . $lang['approve_post_is_awaiting'] . " ]";
                                        $message = $post_subject;
                                        $quote_img = '';
                                        $quote = '';
                                        $poster = ($postrow[$i]['poster_id'] == ANONYMOUS) ? $lang['Guest'] : $poster;
                                }
                        }
                }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
modules/Forums/admin/admin_forumauth.php

#
#-----[ FIND ]-----------------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     Global Announcements               v1.2.8 ]
 ******************************************************/
//                View      Read      Post      Reply     Edit     Delete    Sticky   Announce    Vote      Poll      Global Announcement
$simple_auth_ary = array(
        0  => array(AUTH_ALL, AUTH_ALL, AUTH_ALL, AUTH_ALL, AUTH_REG, AUTH_REG, AUTH_MOD, AUTH_MOD, AUTH_REG, AUTH_REG, AUTH_MOD),
        1  => array(AUTH_ALL, AUTH_ALL, AUTH_REG, AUTH_REG, AUTH_REG, AUTH_REG, AUTH_MOD, AUTH_MOD, AUTH_REG, AUTH_REG, AUTH_MOD),
        2  => array(AUTH_REG, AUTH_REG, AUTH_REG, AUTH_REG, AUTH_REG, AUTH_REG, AUTH_MOD, AUTH_MOD, AUTH_REG, AUTH_REG, AUTH_MOD),
        3  => array(AUTH_ALL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_MOD, AUTH_ACL, AUTH_ACL, AUTH_MOD),
        4  => array(AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_MOD, AUTH_ACL, AUTH_ACL, AUTH_MOD),
        5  => array(AUTH_ALL, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD),
        6  => array(AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD),
/*****[END]********************************************
 [ Mod:     Global Announcements               v1.2.8 ]
 ******************************************************/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     Global Announcements               v1.2.8 ]
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
//                  View      Read      Post      News      Reply     Edit      Delete    Sticky    Announce  Vote      Poll      Global Announcement
$simple_auth_ary = array(
        0  => array(AUTH_ALL, AUTH_ALL, AUTH_ALL, AUTH_MOD, AUTH_ALL, AUTH_REG, AUTH_REG, AUTH_MOD, AUTH_MOD, AUTH_REG, AUTH_REG, AUTH_MOD),
        1  => array(AUTH_ALL, AUTH_ALL, AUTH_REG, AUTH_MOD, AUTH_REG, AUTH_REG, AUTH_REG, AUTH_MOD, AUTH_MOD, AUTH_REG, AUTH_REG, AUTH_MOD),
        2  => array(AUTH_REG, AUTH_REG, AUTH_REG, AUTH_MOD, AUTH_REG, AUTH_REG, AUTH_REG, AUTH_MOD, AUTH_MOD, AUTH_REG, AUTH_REG, AUTH_MOD),
        3  => array(AUTH_ALL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_MOD, AUTH_ACL, AUTH_ACL, AUTH_MOD),
        4  => array(AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_ACL, AUTH_MOD, AUTH_ACL, AUTH_ACL, AUTH_MOD),
        5  => array(AUTH_ALL, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD),
        6  => array(AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD, AUTH_MOD),
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 [ Mod:     Global Announcements               v1.2.8 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     Global Announcements               v1.2.8 ]
 ******************************************************/
$forum_auth_fields = array('auth_view', 'auth_read', 'auth_post', 'auth_reply', 'auth_edit', 'auth_delete', 'auth_sticky', 'auth_announce', 'auth_vote', 'auth_pollcreate', 'auth_globalannounce');
/*****[END]********************************************
 [ Mod:     Global Announcements               v1.2.8 ]
 ******************************************************/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     Global Announcements               v1.2.8 ]
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
$forum_auth_fields = array('auth_view', 'auth_read', 'auth_post', 'auth_news', 'auth_reply', 'auth_edit', 'auth_delete', 'auth_sticky', 'auth_announce', 'auth_vote', 'auth_pollcreate', 'auth_globalannounce');
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 [ Mod:     Global Announcements               v1.2.8 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
        /*--FNA--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
        'auth_news' => $lang['News'],
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
modules/Forums/admin/admin_forums.php

#
#-----[ FIND ]-----------------------------------------
#
                                /*--FNA #1--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                                $approve_mod = array();
                                $sql = "SELECT * FROM " . APPROVE_FORUMS_TABLE . " 
                                        WHERE forum_id = " . intval($forum_id);
                                if ( !($result = $db->sql_query($sql)) )
                                {
                                        message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'], '', __LINE__, __FILE__, $sql);
                                }
                                if ( $row_approve = $db->sql_fetchrow($result) )
                                {
                                        $approve_mod['moderators'] = array();
                                        $approve_mod['moderators'] = explode('|', $row_approve['approve_moderators']);

                                        $row_approve['approve_notify_user_options'] = '';
                                        $row_approve['approve_notify_user_list'] = '';

                                        for($i = 0; !empty($approve_mod['moderators'][$i]); $i++)
                                        {
                                                $sql = "SELECT username 
                                                        FROM " . USERS_TABLE . "
                                                        WHERE user_id = " . intval($approve_mod['moderators'][$i]);
                                                if ( !$result = $db->sql_query($sql) )
                                                {
                                                        message_die(GENERAL_ERROR, "Couldn't get forum Prune Information","",__LINE__, __FILE__, $sql);
                                                }
                                                if ( $row_user = $db->sql_fetchrow($result) )
                                                {
                                                        if ( $row_user['user_id'] != ANONYMOUS )
                                                        {
                                                                $row_approve['approve_notify_user_options'] = $row_approve['approve_notify_user_options'] . "\n<option>" . $row_user['username'] . "</option>";
                                                                if ( $row_approve['approve_notify_user_list'] == '' )
                                                                {
                                                                        $row_approve['approve_notify_user_list'] = $row_user['username'];
                                                                }
                                                                else
                                                                {
                                                                        $row_approve['approve_notify_user_list'] = $row_approve['approve_notify_user_list'] . "  |  " . $row_user['username'];
                                                                        //used two spaces on either side, because phpBB truncates spaces in usernames.
                                                                }
                                                        }
                                                }
                                        }

                                        $approve_mod['notify_user_options'] = $row_approve['approve_notify_user_options'];
                                        $approve_mod['notify_user_list'] = $row_approve['approve_notify_user_list'];
                                        $approve_mod['enabled'] = ( intval($row_approve['enabled']) == 1 ) ? "checked" : "";
                                        $approve_mod['posts_enabled'] = ( intval($row_approve['approve_posts']) == 1 ) ? "checked" : "";
                                        $approve_mod['poste_enabled'] = ( intval($row_approve['approve_poste']) == 1 ) ? "checked" : "";
                                        $approve_mod['topics_enabled'] = ( intval($row_approve['approve_topics']) == 1 ) ? "checked" : "";
                                        $approve_mod['topice_enabled'] = ( intval($row_approve['approve_topice']) == 1 ) ? "checked" : "";
                                        $approve_mod['users_enabled'] = ( intval($row_approve['approve_users']) == 1 ) ? "checked" : "";
                                        $approve_mod['users_disabled'] = ( intval($row_approve['approve_users']) == 1 ) ? "" : "checked";
                                        $approve_mod['notify_user_enabled'] = ( intval($row_approve['approve_notify_approval']) == 1 ) ? "checked" : "";
                                        $approve_mod['notify_user_disabled'] = ( intval($row_approve['approve_notify_approval']) == 1 ) ? "" : "checked";
                                        $approve_mod['notify_enabled'] = ( intval($row_approve['approve_notify']) == 1 ) ? "checked" : "";
                                        $approve_mod['notify_disabled'] = ( intval($row_approve['approve_notify']) == 1 ) ? "" : "checked";
                                        $approve_mod['notify_pm_enabled'] = ( intval($row_approve['approve_notify_type']) == 1 ) ? "checked" : "";
                                        $approve_mod['notify_email_enabled'] = ( intval($row_approve['approve_notify_type']) == 1 ) ? "" : "checked";
                                        $approve_mod['notify_message_enabled'] = ( intval($row_approve['approve_notify_message']) == 1 ) ? "checked" : "";
                                        $approve_mod['notify_message_len'] = intval($row_approve['approve_notify_message_len']);
                                        $approve_mod['notify_posts_enabled'] = ( intval($row_approve['approve_notify_posts']) == 1 ) ? "checked" : "";
                                        $approve_mod['notify_poste_enabled'] = ( intval($row_approve['approve_notify_poste']) == 1 ) ? "checked" : "";
                                        $approve_mod['notify_topics_enabled'] = ( intval($row_approve['approve_notify_topics']) == 1 ) ? "checked" : "";
                                        $approve_mod['notify_topice_enabled'] = ( intval($row_approve['approve_notify_topice']) == 1 ) ? "checked" : "";
                                        $approve_mod['hide_topics_enabled'] = ( intval($row_approve['forum_hide_unapproved_topics']) == 1 ) ? "checked" : "";
                                        $approve_mod['hide_posts_enabled'] = ( intval($row_approve['forum_hide_unapproved_posts']) == 1 ) ? "checked" : "";
                                        $approve_mod['hide_topics_disabled'] = ( intval($row_approve['forum_hide_unapproved_topics']) == 1 ) ? "" : "checked";
                                        $approve_mod['hide_posts_disabled'] = ( intval($row_approve['forum_hide_unapproved_posts']) == 1 ) ? "" : "checked";
                                }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
                        /*--FNA #2--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                        if ( $mode == 'editforum' )
                        {
                                $template->assign_block_vars("approve_mod_switch", array() );
                                $template->assign_vars(array(
                                        'L_APPROVE_POSTS' => $lang['approve_admin_posts'],
                                        'L_APPROVE_ENABLE' => $lang['approve_admin_enable'],
                                        'L_APPROVE_POSTS_TOPICS' => $lang['approve_admin_posts_topics'],
                                        'L_APPROVE_NOTIFY_POSTS_TOPICS' => $lang['approve_admin_notify_posts_topics'],
                                        'L_APPROVE_POSTS_ENABLE' => $lang['approve_admin_posts_enable'],
                                        'L_APPROVE_TOPICS_ENABLE' => $lang['approve_admin_topics_enable'],
                                        'L_APPROVE_USERS_ENABLE' => $lang['approve_admin_users_enable'],
                                        'L_APPROVE_USERS_ALL' => $lang['approve_admin_users_all'],
                                        'L_APPROVE_USERS_MOD' => $lang['approve_admin_users_mod'],
                                        'L_APPROVE_POSTE_ENABLE' => $lang['approve_admin_poste_enable'],
                                        'L_APPROVE_TOPICE_ENABLE' => $lang['approve_admin_topice_enable'],
                                        'L_APPROVE_NOTIFY_ENABLE' => $lang['approve_admin_notify_admin_enable'],
                                        'L_APPROVE_NOTIFY_USER_ENABLE' => $lang['approve_admin_notify_user_enable'],
                                        'L_APPROVE_NOTIFY_TYPE' => $lang['approve_admin_notify_type'],
                                        'L_APPROVE_NOTIFY_PM_ENABLE' => $lang['approve_admin_notify_pm_enable'],
                                        'L_APPROVE_NOTIFY_EMAIL_ENABLE' => $lang['approve_admin_notify_email_enable'],
                                        'L_APPROVE_NOTIFY_MESSAGE_ENABLE' => $lang['approve_admin_notify_message_enable'],
                                        'L_APPROVE_NOTIFY_MESSAGE_LEN' => $lang['approve_admin_notify_message_length'],
                                        'L_APPROVE_NOTIFY_ENABLED' => $lang['Enabled'],
                                        'L_APPROVE_NOTIFY_DISABLED' => $lang['Disabled'],
                                        'L_APPROVE_NOTIFY_USER' => $lang['approve_admin_moderators'],
                                        'L_APPROVE_NOTIFY_POSTS_ENABLE' => $lang['approve_admin_notify_posts_enable'],
                                        'L_APPROVE_NOTIFY_POSTE_ENABLE' => $lang['approve_admin_notify_poste_enable'],
                                        'L_APPROVE_NOTIFY_TOPICS_ENABLE' => $lang['approve_admin_notify_topics_enable'],
                                        'L_APPROVE_NOTIFY_TOPICE_ENABLE' => $lang['approve_admin_notify_topice_enable'],
                                        'L_APPROVE_BUTTON_FIND' => $lang['approve_admin_button_find'],
                                        'L_APPROVE_BUTTON_ADD' => $lang['approve_admin_button_add'],
                                        'L_APPROVE_BUTTON_REM' => $lang['approve_admin_button_rem'],
                                        'L_APPROVE_HIDE_TOPICS_ENABLE' => $lang['approve_admin_hide_topics_enable'],
                                        'L_APPROVE_HIDE_POSTS_ENABLE' => $lang['approve_admin_hide_posts_enable'],
                                        'S_APPROVE_ENABLED' => $approve_mod['enabled'],
                                        'S_APPROVE_POSTS_ENABLED' => $approve_mod['posts_enabled'],
                                        'S_APPROVE_POSTE_ENABLED' => $approve_mod['poste_enabled'],
                                        'S_APPROVE_TOPICS_ENABLED' => $approve_mod['topics_enabled'],
                                        'S_APPROVE_TOPICE_ENABLED' => $approve_mod['topice_enabled'],
                                        'S_APPROVE_USERS_ENABLED' => $approve_mod['users_enabled'],
                                        'S_APPROVE_USERS_DISABLED' => $approve_mod['users_disabled'],
                                        'S_APPROVE_NOTIFY_ENABLED' => $approve_mod['notify_enabled'],
                                        'S_APPROVE_NOTIFY_USER_ENABLED' => $approve_mod['notify_user_enabled'],
                                        'S_APPROVE_NOTIFY_USER_DISABLED' => $approve_mod['notify_user_disabled'],
                                        'S_APPROVE_NOTIFY_PM_ENABLED' => $approve_mod['notify_pm_enabled'],
                                        'S_APPROVE_NOTIFY_EMAIL_ENABLED' => $approve_mod['notify_email_enabled'],
                                        'S_APPROVE_NOTIFY_MESSAGE_ENABLED' => $approve_mod['notify_message_enabled'],
                                        'S_APPROVE_NOTIFY_MESSAGE_LEN' => $approve_mod['notify_message_len'],
                                        'S_APPROVE_NOTIFY_DISABLED' => $approve_mod['notify_disabled'],
                                        'S_APPROVE_NOTIFY_USER_OPTIONS' => $approve_mod['notify_user_options'],
                                        'S_APPROVE_NOTIFY_USER_LIST' => $approve_mod['notify_user_list'],
                                        'S_APPROVE_NOTIFY_POSTS_ENABLED' => $approve_mod['notify_posts_enabled'],
                                        'S_APPROVE_NOTIFY_POSTE_ENABLED' => $approve_mod['notify_poste_enabled'],
                                        'S_APPROVE_NOTIFY_TOPICS_ENABLED' => $approve_mod['notify_topics_enabled'],
                                        'S_APPROVE_NOTIFY_TOPICE_ENABLED' => $approve_mod['notify_topice_enabled'],
                                        'S_APPROVE_HIDE_TOPICS_ENABLED' => $approve_mod['hide_topics_enabled'],
                                        'S_APPROVE_HIDE_POSTS_ENABLED' => $approve_mod['hide_posts_enabled'],
                                        'S_APPROVE_HIDE_TOPICS_DISABLED' => $approve_mod['hide_topics_disabled'],
                                        'S_APPROVE_HIDE_POSTS_DISABLED' => $approve_mod['hide_posts_disabled'] )
                                );
                        }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
                        /*--FNA #3--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
                        $approve_notify_user_list = '';
                        $approve_enable = (intval($HTTP_POST_VARS['approve_enable']) == 1) ? 1 : 0;

                        if ( trim($HTTP_POST_VARS['usernames_list']) != '' )
                        {
                                $approve_mod['moderators'] = array();
                                $approve_mod['moderators'] = explode('  |  ', trim($HTTP_POST_VARS['usernames_list']));

                                for($i = 0; !empty($approve_mod['moderators'][$i]); $i++)
                                {
                                        $sql = "SELECT user_id, user_level 
                                                FROM " . USERS_TABLE . " 
                                                WHERE username = '" . $approve_mod['moderators'][$i] . "'";
                                        if ( !$result = $db->sql_query($sql) )
                                        {
                                                message_die(GENERAL_ERROR, $lang['approve_posts_error_obtain'],"",__LINE__, __FILE__, $sql);
                                        }
                                        if ( $row_user = $db->sql_fetchrow($result) )
                                        {
                                                if ( intval($row_user['user_id']) != intval(ANONYMOUS) && intval($row_user['user_level']) != intval(DELETED) )
                                                {
                                                        if ( $approve_notify_user_list == '' )
                                                        {
                                                                $approve_notify_user_list = $row_user['user_id'];
                                                        }
                                                        else
                                                        {
                                                                $approve_notify_user_list = $approve_notify_user_list . '|' . $row_user['user_id'];
                                                        }
                                                }
                                                else
                                                {
                                                        message_die(GENERAL_ERROR, $lang['approve_admin_notify_user_invalid'] . $approve_mod['moderators'][$i]);
                                                }
                                        }
                                        else
                                        {
                                                message_die(GENERAL_ERROR, $lang['approve_admin_notify_user_invalid'] . $approve_mod['moderators'][$i]);
                                        }
                                }
                        }
                        else
                        {
                                if ( $HTTP_POST_VARS['approve_notify_enable'] )
                                {
                                        message_die(GENERAL_ERROR, $lang['approve_admin_notify_user_empty']);
                                }
                        }
                        $sql = "DELETE FROM " . APPROVE_FORUMS_TABLE . " 
                                WHERE forum_id = " . intval($HTTP_POST_VARS[POST_FORUM_URL]);
                        if ( !$result = $db->sql_query($sql) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_delete'], '', __LINE__, __FILE__, $sql);
                        }
                        $sql = "INSERT INTO " . APPROVE_FORUMS_TABLE . " (forum_id, enabled, approve_posts, approve_topics, approve_users, approve_poste, approve_topice, approve_notify, approve_notify_type, approve_notify_message, approve_notify_message_len, approve_moderators, approve_notify_posts, approve_notify_poste, approve_notify_topics, approve_notify_topice, approve_notify_approval, forum_hide_unapproved_topics, forum_hide_unapproved_posts) 
                                VALUES (" . intval($HTTP_POST_VARS[POST_FORUM_URL]) . ", " . intval($approve_enable) . ", " . intval($HTTP_POST_VARS['approve_posts_enable']) . ", " . intval($HTTP_POST_VARS['approve_topics_enable']) . ", " . intval($HTTP_POST_VARS['approve_users_enable']) . ", " . intval($HTTP_POST_VARS['approve_poste_enable']) . ", " . intval($HTTP_POST_VARS['approve_topice_enable']) . ", " . intval($HTTP_POST_VARS['approve_notify_enable']) . ", " . intval($HTTP_POST_VARS['approve_notify_type_enable']) . ", " . intval($HTTP_POST_VARS['approve_notify_message_enable']) . ", " . intval($HTTP_POST_VARS['approve_notify_message_len']) . ", '" . $approve_notify_user_list . "', " . intval($HTTP_POST_VARS['approve_notify_posts_enable']) . ", " . intval($HTTP_POST_VARS['approve_notify_poste_enable']) . ", " . intval($HTTP_POST_VARS['approve_notify_topics_enable']) . ", " . intval($HTTP_POST_VARS['approve_notify_topice_enable']) . ", " . intval($HTTP_POST_VARS['approve_notify_user_enable']) . ", " . intval($HTTP_POST_VARS['approve_hide_topics_enable']) . ", " . intval($HTTP_POST_VARS['approve_hide_posts_enable']) . ")";
                        if ( !$result = $db->sql_query($sql) )
                        {
                                message_die(GENERAL_ERROR, $lang['approve_posts_error_insert'], '', __LINE__, __FILE__, $sql);
                        }
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
modules/Forums/admin/admin_ug_auth.php

#
#-----[ FIND ]-----------------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     Global Announcements               v1.2.8 ]
 ******************************************************/
$forum_auth_fields = array('auth_view', 'auth_read', 'auth_post', 'auth_reply', 'auth_edit', 'auth_delete', 'auth_sticky', 'auth_announce', 'auth_vote', 'auth_pollcreate', 'auth_globalannounce');
/*****[END]********************************************
 [ Mod:     Global Announcements               v1.2.8 ]
 ******************************************************/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     Global Announcements               v1.2.8 ]
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
$forum_auth_fields = array('auth_view', 'auth_read', 'auth_post', 'auth_news', 'auth_reply', 'auth_edit', 'auth_delete', 'auth_sticky', 'auth_announce', 'auth_vote', 'auth_pollcreate', 'auth_globalannounce');
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 [ Mod:     Global Announcements               v1.2.8 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
        /*--FNA--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
        'auth_news' => $lang['News'],
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
modules/Forums/templates/subSilver/admin/forum_edit_body.tpl

#
#-----[ FIND ]-----------------------------------------
#
<form action="{S_FORUM_ACTION}" method="post">

#
#-----[ AFTER ADD ]------------------------------------
#
<!-- Begin ForumNews Advance //-->
</form>
<script language= "JavaScript">
<!--

function addUsername()
{
        len = document.post.usernames.length;
        if ( document.post.username.value == "" )
        {
                alert("Please enter a name!");
                document.post.username.value = "";
                return false;
        }
        for (i = 0; i < (document.post.usernames.length); i++)
        {
                if (document.post.usernames.options[i].text == document.post.username.value)
                {
                        alert("Please enter a new unique name!");
                        document.post.username.value = "";
                        return false;
                }
        }
        if ( len > 9 )
        {
                alert("Please only enter a maximum of up to 10 names!");
                return false;
        }
        document.post.usernames.options[len] = new Option(document.post.username.value);
        document.post.usernames.options[len].text = document.post.username.value;

        updateUsername();
        document.post.username.value = "";
        return false;
}

function remUsername()
{
        for (i = 0; i < (document.post.usernames.length); i++)
        {
                if ( document.post.usernames.options[i].selected && document.post.usernames.options[i] != null )
                {
                        document.post.usernames.options[i] = null;
                        i = i - 1;
                }
        }
        updateUsername();
        return false;
}

function updateUsername()
{
        new_value = '';
        for (i = 0; i < document.post.usernames.length; i++)
        {
                if ( document.post.usernames.options[i] != null )
                {
                        if ( i == 0 )
                        {
                                new_value = document.post.usernames.options[i].text;
                        }
                        else
                        {
                                new_value = new_value + "  |  " + document.post.usernames.options[i].text;
                        }
                }
        }
        document.post.usernames_list.value = new_value;
}
//-->
</script>
<form action="{S_FORUM_ACTION}" method="post" name="post">
<!-- End ForumNews Advance //-->

#
#-----[ FIND ]-----------------------------------------
#
    <tr>
      <td class="catBottom" colspan="2" align="center">{S_HIDDEN_FIELDS}<input type="submit" name="submit" value="{S_SUBMIT_VALUE}" class="mainoption" /></td>
    </tr>

#
#-----[ BEFORE ADD ]-----------------------------------
#
<!-- Begin ForumNews Advance //-->
<!-- BEGIN approve_mod_switch -->
        <tr> 
          <td valign="top" class="row1">{L_APPROVE_POSTS}</td>
          <td class="row2">
             <table width="100%" border="0" cellpadding="1" cellspacing="0">
          <tr> 
            <td align="right" valign="middle" nowrap>{L_APPROVE_ENABLE}</td>
            <td align="left" valign="middle" nowrap><input type="checkbox" name="approve_enable" value="1" {S_APPROVE_ENABLED} /></td>
          </tr>
          <tr> 
            <td align="right" valign="middle" nowrap>{L_APPROVE_USERS_ENABLE}</td>
            <td align="left" valign="middle" nowrap><input type="radio" name="approve_users_enable" value="1" {S_APPROVE_USERS_ENABLED} />
              {L_APPROVE_USERS_ALL}&nbsp;&nbsp; <input type="radio" name="approve_users_enable" value="0" {S_APPROVE_USERS_DISABLED} />
              {L_APPROVE_USERS_MOD}</td>
          </tr>
          <tr> 
            <td align="right" valign="top" nowrap>{L_APPROVE_POSTS_TOPICS}</td>
            <td align="left" valign="middle" nowrap><table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr> 
                  <td width="50%" nowrap><input type="checkbox" name="approve_topics_enable" value="1" {S_APPROVE_TOPICS_ENABLED} />
                    {L_APPROVE_TOPICS_ENABLE}</td>
                  <td width="50%" nowrap><input type="checkbox" name="approve_posts_enable" value="1" {S_APPROVE_POSTS_ENABLED} />
                    {L_APPROVE_POSTS_ENABLE}</td>
                </tr>
                <tr> 
                  <td nowrap><input type="checkbox" name="approve_topice_enable" value="1" {S_APPROVE_TOPICE_ENABLED} />
                    {L_APPROVE_TOPICE_ENABLE}</td>
                  <td nowrap> <input type="checkbox" name="approve_poste_enable" value="1" {S_APPROVE_POSTE_ENABLED} />
                    {L_APPROVE_POSTE_ENABLE}</td>
                </tr>
              </table></td>
          </tr>
          <tr> 
            <td align="right" valign="middle" nowrap>{L_APPROVE_NOTIFY_USER}</td>
            <td align="left" valign="middle" nowrap>
             <table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr> 
                  <td width="50%" nowrap><input class="post" type="text" name="username" size="20" /></td>
                  <td width="50%" nowrap><input type="button" name="usersearch" value="{L_APPROVE_BUTTON_FIND}" class="liteoption" onClick="window.open('./../../../modules.php?name=Forums&file=search&mode=searchuser&popup=1&menu=1', '_phpbbsearch', 'HEIGHT=250,resizable=yes,WIDTH=400');return false;" /></td>
                </tr>
                <tr>
                  <td rowspan="2" valign="top" nowrap>
                    <select name="usernames" size="3" multiple>
                          {S_APPROVE_NOTIFY_USER_OPTIONS}
                    </select>
                  </td>
                  <td nowrap>
                    <input type="button" name="add" value="{L_APPROVE_BUTTON_ADD}" class="liteoption" onClick="javascript: addUsername();"><input name="usernames_list" type="hidden" value="{S_APPROVE_NOTIFY_USER_LIST}"><br/>
                  </td>
                </tr>
                <tr>
                 <td nowrap><input type="button" name="remove" value="{L_APPROVE_BUTTON_REM}" class="liteoption" onClick="javascript: remUsername();"></td>
                </tr>
              </table>
            </td>
          </tr>
          <tr> 
            <td align="right" valign="middle" nowrap>{L_APPROVE_NOTIFY_USER_ENABLE}</td>
            <td align="left" valign="middle" nowrap><table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr> 
                  <td width="50%" nowrap><input type="radio" name="approve_notify_user_enable" value="1" {S_APPROVE_NOTIFY_USER_ENABLED} />
                    {L_APPROVE_NOTIFY_ENABLED}</td>
                  <td width="50%" nowrap><input type="radio" name="approve_notify_user_enable" value="0" {S_APPROVE_NOTIFY_USER_DISABLED} />
                    {L_APPROVE_NOTIFY_DISABLED}</td>
                </tr>
              </table>
            </td>
          </tr>
          <tr> 
            <td align="right" valign="middle" nowrap>{L_APPROVE_HIDE_TOPICS_ENABLE}</td>
            <td align="left" valign="middle" nowrap><table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr> 
                  <td width="50%" nowrap><input type="radio" name="approve_hide_topics_enable" value="1" {S_APPROVE_HIDE_TOPICS_ENABLED} />
                    {L_APPROVE_NOTIFY_ENABLED}</td>
                  <td width="50%" nowrap><input type="radio" name="approve_hide_topics_enable" value="0" {S_APPROVE_HIDE_TOPICS_DISABLED} />
                    {L_APPROVE_NOTIFY_DISABLED}</td>
                </tr>
              </table>
            </td>
          </tr>
          <tr> 
            <td align="right" valign="middle" nowrap>{L_APPROVE_HIDE_POSTS_ENABLE}</td>
            <td align="left" valign="middle" nowrap><table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr> 
                  <td width="50%" nowrap><input type="radio" name="approve_hide_posts_enable" value="1" {S_APPROVE_HIDE_POSTS_ENABLED} />
                    {L_APPROVE_NOTIFY_ENABLED}</td>
                  <td width="50%" nowrap><input type="radio" name="approve_hide_posts_enable" value="0" {S_APPROVE_HIDE_POSTS_DISABLED} />
                    {L_APPROVE_NOTIFY_DISABLED}</td>
                </tr>
              </table>
            </td>
          </tr>
          <tr>
            <td align="right" valign="middle" nowrap>{L_APPROVE_NOTIFY_ENABLE}</td>
            <td align="left" valign="middle" nowrap><table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr> 
                  <td width="50%" nowrap><input type="radio" name="approve_notify_enable" value="1" {S_APPROVE_NOTIFY_ENABLED} />
                    {L_APPROVE_NOTIFY_ENABLED}</td>
                  <td width="50%" nowrap><input type="radio" name="approve_notify_enable" value="0" {S_APPROVE_NOTIFY_USER_DISABLED} />
                    {L_APPROVE_NOTIFY_DISABLED}</td>
                </tr>
              </table>
            </td>
          </tr>
          <tr> 
            <td align="right" valign="top" nowrap>{L_APPROVE_NOTIFY_POSTS_TOPICS}</td>
            <td align="left" valign="middle" nowrap><table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr> 
                  <td width="50%" nowrap><input type="checkbox" name="approve_notify_topics_enable" value="1" {S_APPROVE_NOTIFY_TOPICS_ENABLED} />
                    {L_APPROVE_NOTIFY_TOPICS_ENABLE}</td>
                  <td width="50%" nowrap><input type="checkbox" name="approve_notify_posts_enable" value="1" {S_APPROVE_NOTIFY_POSTS_ENABLED} />
                    {L_APPROVE_NOTIFY_POSTS_ENABLE}</td>
                </tr>
                <tr> 
                  <td nowrap><input type="checkbox" name="approve_notify_topice_enable" value="1" {S_APPROVE_NOTIFY_TOPICE_ENABLED} />
                    {L_APPROVE_NOTIFY_TOPICE_ENABLE}</td>
                  <td nowrap><input type="checkbox" name="approve_notify_poste_enable" value="1" {S_APPROVE_NOTIFY_POSTE_ENABLED} />
                    {L_APPROVE_NOTIFY_POSTE_ENABLE} </td>
                </tr>
              </table></td>
          </tr>
          <tr> 
            <td align="right" valign="middle" nowrap>{L_APPROVE_NOTIFY_TYPE}</td>
            <td align="left" valign="middle" nowrap> <table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr> 
                  <td width="50%" nowrap><input type="radio" name="approve_notify_type_enable" value="1" {S_APPROVE_NOTIFY_PM_ENABLED} />
                    {L_APPROVE_NOTIFY_PM_ENABLE}</td>
                  <td width="50%" nowrap><input type="radio" name="approve_notify_type_enable" value="-1" {S_APPROVE_NOTIFY_EMAIL_ENABLED} />
                    {L_APPROVE_NOTIFY_EMAIL_ENABLE}</td>
                </tr>
              </table></td>
          </tr>
          <tr> 
            <td align="right" valign="middle" nowrap>{L_APPROVE_NOTIFY_MESSAGE_ENABLE}</td>
            <td align="left" valign="middle" nowrap><table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr> 
                  <td width="50%" nowrap><input type="checkbox" name="approve_notify_message_enable" value="1" {S_APPROVE_NOTIFY_MESSAGE_ENABLED} />
                    {L_APPROVE_NOTIFY_ENABLED}</td>
                  <td width="50%" nowrap><input class="post" type="text" name="approve_notify_message_len" value="{S_APPROVE_NOTIFY_MESSAGE_LEN}" size="5" />
                    {L_APPROVE_NOTIFY_MESSAGE_LEN} </td>
                </tr>
              </table></td>
          </tr>
        </table>
          </td>
        </tr>
<!-- END approve_mod_switch -->
<!-- End ForumNews Advance //-->

#
#-----[ OPEN ]-----------------------------------------
#
modules/News/index.php

#
#-----[ FIND ]-----------------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:    Advanced Username Color             v1.0.5 ]
 ******************************************************/
                themeindex($artinfo["aid"], $informant, $datetime, $artinfo["title"], $artinfo["counter"], $artinfo["topic"], $artinfo["hometext"], $artinfo["notes"], $morelink, $topicname, $topicimage, $topictext);
/*****[END]********************************************
 [ Mod:    Advanced Username Color             v1.0.5 ]
 ******************************************************/

#
#-----[ REPLACE WITH ]--------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:    Advanced Username Color             v1.0.5 ]
 [ Mod:    FNA                                 v3.0.0 ]
 ******************************************************/
                $topiclink = "<a href=\"modules.php?name=News&amp;new_topic=$topic\">";
                themeindex($artinfo["aid"], $informant, $datetime, $artinfo["title"], $artinfo["counter"], $artinfo["topic"], $artinfo["hometext"], $artinfo["notes"], $morelink, $topicname, $topicimage, $topictext, $topiclink);
/*****[END]********************************************
 [ Mod:    FNA                                 v3.0.0 ]
 [ Mod:    Advanced Username Color             v1.0.5 ]
 ******************************************************/
 
#
#-----[ FIND ]-----------------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:    Advanced Username Color             v1.0.5 ]
 ******************************************************/
                themeindex($artinfo["aid"], $informant, $datetime, $artinfo["title"], $artinfo["counter"], $artinfo["topic"], $artinfo["hometext"], $artinfo["notes"], $morelink, $topicname, $topicimage, $topictext);
/*****[END]********************************************
 [ Mod:    Advanced Username Color             v1.0.5 ]
 ******************************************************/


#
#-----[ REPLACE WITH ]--------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:    Advanced Username Color             v1.0.5 ]
 [ Mod:    FNA                                 v3.0.0 ]
 ******************************************************/
                $topiclink = "<a href=\"modules.php?name=News&amp;new_topic=$topic\">";
                themeindex($artinfo["aid"], $informant, $datetime, $artinfo["title"], $artinfo["counter"], $artinfo["topic"], $artinfo["hometext"], $artinfo["notes"], $morelink, $topicname, $topicimage, $topictext, $topiclink);
/*****[END]********************************************
 [ Mod:    FNA                                 v3.0.0 ]
 [ Mod:    Advanced Username Color             v1.0.5 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
themes/YOUR_THEME/story_home.html
Note: if this file doesn't exist, look inside theme.php

#
#-----[ FIND ]-----------------------------------------
#
<a href="modules.php?name=News&amp;new_topic=$topic">

#
#-----[ REPLACE WITH ]---------------------------------
#
<!--Begin ForumNews Advance-->
<!--<a href="modules.php?name=News&amp;new_topic=$topic">-->
$topiclink
<!--End ForumNews Advance-->

#
#-----[ OPEN ]-----------------------------------------
#
themes/YOUR_THEME/theme.php

#
#-----[ FIND ]-----------------------------------------
#
function themeindex ($aid, $informant, $time, $title, $counter, $topic, $thetext, $notes, $morelink, $topicname, $topicimage, $topictext) {

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
function themeindex ($aid, $informant, $time, $title, $counter, $topic, $thetext, $notes, $morelink, $topicname, $topicimage, $topictext, $topiclink) {
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ FIND ]-----------------------------------------
#
        $topic_img = "<td width=\"25%\" align=\"center\" class=\"extra\"><a href=\"modules.php?name=News&amp;new_topic=".$topic."\"><img src=\"".$t_image."\" border=\"0\" alt=\"$topictext\" /></a></td>";

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/
        $topic_img = "<td width=\"25%\" align=\"center\" class=\"extra\">".$topiclink."<img src=\"".$t_image."\" border=\"0\" alt=\"$topictext\" /></a></td>";
/*****[END]********************************************
 [ Mod:     FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ OPEN ]-----------------------------------------
#
themes/YOUR_THEME/forums/posting_body.tpl

AND

modules/Forums/templates/subSilver/posting_body.tpl

#
#-----[ FIND ]-----------------------------------------
#
    <tr>
      <td class="row1" width="22%"><span class="gen"><strong>{L_SUBJECT}</strong></span></td>
      <td class="row2" width="78%"> <span class="gen">
        <input type="text" name="subject" size="45" maxlength="60" style="width:450px" tabindex="2" class="post" value="{SUBJECT}" />
        </span> </td>
    </tr>

#
#-----[ AFTER ADD ]------------------------------------
#
    <!-- BEGIN switch_news_cat -->
    <tr>
      <td class="row1" width="22%"><span class="gen"><strong>{switch_news_cat.L_NEWS_CATEGORY}</strong></span></td>
      <td class="row2" width="78%">
      <select name="{switch_news_cat.S_NAME}">
      {switch_news_cat.S_CATEGORY_BOX}
      </select>
      </td>
    </tr>
    <!-- END switch_news_cat -->

#
#-----[ OPEN ]-----------------------------------------
#
themes/YOUR_THEME/forums/viewforum_body.tpl

AND

modules/Forums/templates/subSilver/viewforum_body.tpl

#
#-----[ FIND ]-----------------------------------------
#
{topicrow.TOPIC_TYPE}

#
#-----[ IN-LINE BEFORE ADD ]---------------------------
#
<!-- Begin ForumNews Advance //-->{topicrow.L_NEWS}<!-- End ForumNews Advance //-->

#
#-----[ OPEN ]-----------------------------------------
#
language/custom/lang-english.php

#
#-----[ FIND ]-----------------------------------------
#
/*--FNA--*/

#
#-----[ REPLACE WITH ]---------------------------------
#
/*****[BEGIN]******************************************
 [ Block:  FNA                                v3.0.0 ]
 ******************************************************/
define("_FNA", "ForumNews");
define("_FNATOPICS", "Waiting Topics");
define("_FNAPOSTS", "Waiting Posts");
define("_FNAUSERS", "Approved Users");
/*****[END]********************************************
 [ Block:  FNA                                v3.0.0 ]
 ******************************************************/

#
#-----[ SAVE/CLOSE/UPLOAD ALL FILES ]------------------------------------------
#
# EoM

/***************************************************************************/
/*                                                                         */
/* See Code-Area51.com for detailed information on ForumNews Advance       */
/*                                                                         */
/***************************************************************************/
/*                                                                         */
/* Copyright (c) 2002 - 2006 by http://www.code-area51.com                 */
/*     Mighty_Y - Yannick Reekmans         (webmaster@code-area51.com)     */
/*                                                                         */
/***************************************************************************/
/* All content and includes from this package is intellectual              */
/* property of Code-Area51.com unless stated otherwise. Replication        */
/* of copyrighted material is a civil and criminal act and                 */
/* voilations may result in legal action.                                  */
/***************************************************************************/